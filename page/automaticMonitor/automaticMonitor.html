<!---——————————————————————————自动化列表页 start————————————————————————-->
<link rel="stylesheet" href="../../css/automaticMonitor/automaticMonitor.css">
<div class="auto_list OutermostLayer">
    <div class="auto-nav layui-form" lay-filter="auto_manage">
        <div class="layui-form-item">
            <label class="layui-form-label">自动化名称</label>
            <div class="layui-input-block">
                <input type="text" name="searchAutoName" placeholder="请输入标题名称" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">状态</label>
            <div class="layui-input-block select_state">
                <select id="searchAutoState" name="searchAutoState">
                    <option value="">所有</option>
                    <option value="ACTIVATED">启用</option>
                    <option value="DEACTIVATED">禁用</option>
                </select>
            </div>
        </div>
        <div class="fr">
            <button class="layui-btn layui-btn-normal queryBtn" lay-submit onclick="autoMation.searchChaxun()"
                    lay-filter="um_formSearch">
                查询
            </button>
            <button class="layui-btn layui-btn-normal ResetBtn" lay-submit lay-filter="ResetBtn"
                    onclick="autoMation.ResetOutbox()">
                重置
            </button>
        </div>
    </div>
    <div class="Establish">
        <button class="EstablishBtn layui-btn layui-btn-normal" onclick="autoMation.AddUpdate()">
            +
            新增
        </button>
    </div>
    <table class="autoTable" id="autoTable" lay-filter="autoTable"></table>
    <!--分页-->
    <div id="paging" class="fr"></div>
</div>
<script type="text/html" id="table_operate">
    <div>
        <span class="btn_primary" onclick="autoMation.AddUpdate('{{d.ID}}')">编辑</span>
        <span class="btn_primary"
              onclick="autoMation.editStatus('{{d.ID}}','{{d.Status}}')">{{d.Status == 'ACTIVATED'?"禁用":"启用"}}</span>
        <span class="btn_warn" onclick="autoMation.delete('{{d.ID}}')">删除</span>
    </div>
</script>
<!---——————————————————————————自动化列表页 end————————————————————————-->
<script>
    $(function () {
        autoMation.getListPage();

    });
    var autoMation = {
        id: "",
        pageSize: rowCount,
        pageIndex: 1,
        DeviceList: [],
        TriggerList: [],
        //获取自动化列表
        getListPage: function (name, status) {
            var param = cloneObjectFn(paramList);
            if (name) {
                delete param.name;
                param["name"] = name;
            }
            if (status != 'undefined' || status != "" || status != 'null') {
                delete param.status;
                param["status"] = status;
            }
            param["pageSize"] = autoMation.pageSize;
            param["pageIndex"] = autoMation.pageIndex;
            var postdata = GetPostData(param, "automation", "getListPage");
            postFnajax(postdata).then(function (res) {
                // console.log(":><<<<<<")
                // console.log(res)
                // console.log(param)
                var result = JSON.parse(res);
                laypage.render({
                    elem: 'paging',
                    count: result.page.totalData,
                    limit: autoMation.pageSize,
                    curr: autoMation.pageIndex,
                    layout: ['count', 'prev', 'page', 'next', 'skip'],
                    jump: function (obj, first) {
                        // console.log(obj);
                        if (!first) {
                            autoMation.pageIndex = obj.curr;
                            var param = cloneObjectFn(paramList);
                            if (name) {
                                delete param.name;
                                param["name"] = name;
                            }
                            if (status != undefined || status != "" || status != null) {
                                delete param.status;
                                param["status"] = status;
                            }
                            param["pageSize"] = autoMation.pageSize;
                            param["pageIndex"] = autoMation.pageIndex;
                            var postdata = GetPostData(param, "automation", "getListPage");
                            postFnajax(postdata).then(function (res) {
                                var res = JSON.parse(res)
                                autoMation.createList(res);
                            });
                        }
                    }
                })
                // }
                autoMation.createList(result);
                // }
            })
        },
        //获取自动化列表后动态创建
        createList: function (tableData) {
            table.render({
                elem: '#autoTable',
                cols: [
                    [ //标题栏
                        {
                            type: 'numbers',
                            title: '序号',
                            align: 'center'
                        }, {
                            field: 'Name',
                            title: '自动化名称',
                            align: 'center'
                        }, {
                            field: 'Type',
                            title: '类型',
                            align: 'center',
                            templet: function (d) {
                                return d.Type == "TIME" ? "时间触发" : "设备触发";
                            }
                        }, {
                            field: 'Status',
                            title: '状态',
                            align: 'center',
                            templet: function (d) {
                                return d.Status == 'ACTIVATED' ? "启用" : "禁用";
                            }
                        }, {
                            title: '操作',
                            toolbar: '#table_operate',
                            align: 'center'
                        }
                    ]
                ],
                data: tableData.data,
                skin: 'line',
                even: true,
                limit: autoMation.pageSize,
                id: 'autoTable'
            })
            table.render();
        },
        //列表查询
        searchChaxun: function () {
            var name = $("input[name = searchAutoName]").val();
            var status = $("#searchAutoState").val();
            autoMation.pageIndex = 1;
            autoMation.getListPage(name, status)
        },
        // 重置
        ResetOutbox: function () {
            form.on('submit(ResetBtn)', function () {
                $('input[name="searchAutoName"]').val('');
                form.val("auto_manage", {
                    "searchAutoState": ''
                })
                autoMation.getListPage();
            })
        },
        //删除本条自动化  dom操作
        delete: function (id) {
            layer.confirm('您确定删除该自动化吗？', {
                btn: ['确定', '取消'],
                title: '温馨提示'
            }, function (index) {
                var param = cloneObjectFn(paramList);
                param["id"] = id;
                var postdata = GetPostData(param, "automation", "delete");
                postFnajax(postdata).then(function (res) {
                    var res = JSON.parse(res);
                    if (res.result.code == 200) {
                        layer.msg("删除成功", {
                            icon: 1,
                            time: 1000
                        }, function () {
                            autoMation.pageIndex = 1;
                            autoMation.getListPage();
                        })
                    } else {
                        layer.msg("删除失败", {
                            icon: 2,
                            time: 1000
                        });
                    }
                })
            })
        },
        editStatus: function (id, status) {
            // 修改自动化状态
            // console.log(status)
            var param = cloneObjectFn(paramList);
            param["id"] = id;
            param["status"] = status == "ACTIVATED" ? "DEACTIVATED" : "ACTIVATED";
            var postdata = GetPostData(param, "automation", "updateStatus");
            postFnajax(postdata).then(function (res) {
                // console.log("66666666")
                var res = JSON.parse(res);
                // console.log(res);
                if (res.result.code == 200) {
                    layer.msg("操作成功", {
                        icon: 1,
                        time: 1000
                    }, function () {
                        autoMation.getListPage();
                    })
                } else {
                    layer.msg("操作失败", {
                        icon: 2,
                        time: 1000
                    });
                };
            });
        },
        AddUpdate: function (id) {
            $(".auto_list").css('display', 'none');
            $(".auto_add").css('display', 'block');
            autoMation.GetDeviceList(id);

        },
        GetDeviceList: function (id) {
            var param = cloneObjectFn(paramList);
            var postdata = GetPostData(param, "device", "getList"); //所有设备
            postFnajax(postdata).then(function (res) {
                var result = JSON.parse(res);
                autoMation.DeviceList = result.data;
                //console.log(result.data);
                if (id) {
                    autoMation.id = id;
                    operation = "update";
                    GetAutomationInfo(id);
                } else {
                    autoMation.id = guid();
                    operation = "insert";
                }
            })
        },
        DeviceTrigger: function (obj, type, i) {
            var LandID = "";
            var DeviceID = "";
            var SlotID = "";
            var sort = $('.factor_after li').index($(obj).closest("li"));
            var model;
            if (sort != -1) {
                model = autoMation.TriggerList[sort];
                LandID = model.LandID;
                DeviceID = model.DeviceID;
                SlotID = model.SlotID;
            }

            if (type == "trigger") {
                var title = "";
                if (model) {
                    title = '修改设备触发条件';
                } else {
                    title = '添加设备触发条件';
                    $(".equipment-content2").find("input").val('');
                };

                var layuiobj = layer.open({
                    type: 1,
                    title: title,
                    content: $(".add_equipment"),
                    area: '552px',
                    btn: ['确定', '取消'],
                    yes: function (index, layero) {
                        // 验证选择框是否为空
                        if (LandID == "") {
                            layer.msg('请选择地块', {
                                icon: 2,
                                time: 1500
                            });
                        } else if (DeviceID == "") {
                            layer.msg('请选择设备', {
                                icon: 2,
                                time: 1500
                            });
                        } else if (SlotID == "") {
                            layer.msg('请选择设备通道', {
                                icon: 2,
                                time: 1500
                            });
                        } else {
                            var data = $(".button").find("button").index($(".button .selected"));
                            var obj1 = $(".equipment-content2 .layui-tab-item").index($(
                                ".equipment-content2 .layui-show"));
                            var value1 = $(".equipment-content2 .layui-show").find("input").eq(0)
                                .val();
                            var value2 = $(".equipment-content2 .layui-show").find("input").eq(1)
                                .val();
                            if ($('.equipment-content1').css('display') == "none") {
                                var re = /^\d+(?=\.{0,1}\d+$|$)/;
                                if (obj1 == 0 && !(!!value1 && !isNaN(value1))) {
                                    layer.msg('请输入正确触发条件范围', {
                                        icon: 2,
                                        time: 1500
                                    });
                                } else if (obj1 == 1 && !(!!value1 && !isNaN(value1))) {
                                    layer.msg('请输入正确触发条件范围', {
                                        icon: 2,
                                        time: 1500
                                    });
                                } else if (obj1 == 2 && (!(!!value2 && !isNaN(value2)) || !(!!
                                    value1 && !isNaN(value1)) || value2 * 1 <= value1 * 1)) {
                                    layer.msg('请输入正确触发条件范围', {
                                        icon: 2,
                                        time: 1500
                                    });
                                } else if (obj1 == 3 && !(!!value1 && !isNaN(value1))) {
                                    layer.msg('请输入正确触发条件范围', {
                                        icon: 2,
                                        time: 1500
                                    });
                                } else if (obj1 == 4 && (!(!!value2 && !isNaN(value2)) || !(!!
                                    value1 && !isNaN(value1)) || value2 * 1 <= value1 * 1)) {
                                    layer.msg('请输入正确触发条件范围', {
                                        icon: 2,
                                        time: 1500
                                    });
                                } else {
                                    autoMation.addequipitem(obj, LandID, DeviceID, SlotID, data);
                                    layer.close(index);
                                    DivHide();
                                }
                            } else {
                                autoMation.addequipitem(obj, LandID, DeviceID, SlotID, data);
                                layer.close(index);
                                DivHide();
                            }
                        }
                    },
                    btn2: function (index, layero) {
                        DivHide();
                    },
                    cancel: function () {
                        DivHide();
                    }
                })

                autoMation.SetLandSelect(type, model);
                //选择地块
                form.on('select(lay_area)', function (data) {
                    LandID = data.value;
                    autoMation.SetDeviceSelect(type, {}, LandID);
                    $("#slot").find("option:not(:first)").remove();
                    form.render('select', 'slot');
                    $('.equipment-content1').css('display', 'none');
                    $('.equipment-content2').css('display', 'none');
                    var layerH = ($(window).height() - 357) / 2;
                    layer.style(layuiobj, {
                        top: layerH
                    });
                });
                //选择设备名称
                form.on('select(equipment_name)', function (data) {
                    if (data.value == "") {
                        $('.equipment-content1').css('display', 'none');
                        $('.equipment-content2').css('display', 'none');
                        var layerH = ($(window).height() - 357) / 2;
                        layer.style(layuiobj, {
                            top: layerH
                        });
                    }
                    DeviceID = data.value;
                    autoMation.SetSlotSelect(type, i, DeviceID, layuiobj);
                });
                //选择通道
                form.on('select(slot)', function (data) {
                    SlotID = data.value;
                })
                //温度传感器-设置触发条件 tab切换
                $('.add_equipment .equipment-content2 .layui-tab-title li').on('click', function () {
                    $(this).addClass('layui-this selected').siblings().removeClass(
                        'layui-this selected');
                    $(".add_equipment .equipment-content2 .layui-tab-content .layui-tab-item").eq($(
                        this).index()).addClass("layui-show").siblings().removeClass("layui-show");
                })
                //选择设备下面的对应的风机内容
                $('.add_equipment .equipment-content1 .button button').on('click', function () {
                    $(this).addClass('selected').siblings().removeClass('selected');
                })
                //设备触发条件的tab切换；
                $('.add_equipment .equipment-content2 ul li').on('click', function () {
                    $(this).siblings().find('.rec').css('display', 'none');
                    $(this).find('.rec').css({
                        'display': 'block',
                        'border': 'none'
                    });
                })

                if (model) {
                    autoMation.SetDeviceSelect(type, model, model.LandID);
                    autoMation.SetSlotSelect(type, model, model.DeviceID, layuiobj);
                } else {
                    $("#slot").find("option:not(:first)").remove();
                    $('.equipment-content1').css('display', 'none');
                    $('.equipment-content2').css('display', 'none');
                    $("#device").find("option:not(:first)").remove();
                    form.render('select');
                    var layerH = ($(window).height() - 357) / 2;
                    layer.style(layuiobj, {
                        top: layerH
                    });
                };

            } else {
                sort = $('.time_after li').index($(obj).closest("li"));
                if (sort != -1) {
                    model = autoMation.TriggerList[sort];
                }
                var date_1 = "";
                var date_2 = "";
                var time = "";
                var state = 0;
                $("#date_1").val("");
                $("#date_2").val("");
                $("#date_3").val("");
                $("#date_4").val("");
                if (model) {
                    //var temp = { "Category": "Time", "value1": date_1, "value2": date_2, "type": index };
                    // console.log(model);
                    date_1 = model.value1;
                    date_2 = model.value2;
                    time = model.time;
                    state = model.type
                }
                if (state == 0) {
                    $("#date_1").val(date_1);
                    $("#date_2").val(time);
                    $(".add_time .layui-form .layui-tab ul").html(
                        "<li><input type=\"radio\" name=\"time\" value=\"0\" title=\"指定日期\" checked=\"\"></li><li> <input type=\"radio\" name=\"time\" value=\"1\" title=\"指定时间段\"></li>"
                    )
                    $(".add_time .layui-form .layui-tab .layui-tab-content .layui-tab-item").eq(0).addClass(
                        "layui-show").siblings().removeClass("layui-show");

                } else {
                    $("#date_4").val(time);
                    $("#date_3").val(date_2);
                    $(".add_time .layui-form .layui-tab ul").html(
                        "<li><input type=\"radio\" name=\"time\" value=\"0\" title=\"指定日期\" ></li><li> <input checked=\"\" type=\"radio\" name=\"time\" value=\"1\" title=\"指定时间段\"></li>"
                    )
                    $(".add_time .layui-form .layui-tab .layui-tab-content .layui-tab-item").eq(1).addClass(
                        "layui-show").siblings().removeClass("layui-show");
                }

                form.render('radio');
                layer.open({
                    type: 1,
                    title: '添加时间条件',
                    content: $(".add_time"),
                    area: ['520px', '290px'],
                    btn: ['确定', '取消'],
                    yes: function (index, layero) {
                        date_1 = $("#date_1").val();
                        date_2 = $("#date_3").val();
                        var type = $(
                            ".add_time .layui-form .layui-tab .layui-tab-content .layui-tab-item"
                        ).index($(
                            ".add_time .layui-form .layui-tab .layui-tab-content .layui-show"
                        ));
                        if (type == 0) {
                            time = $("#date_2").val();
                        } else {
                            time = $("#date_4").val();
                        }
                        var index2 = $(
                            ".add_time .layui-form .layui-tab .layui-tab-content .layui-tab-item"
                        ).index($(
                            ".add_time .layui-form .layui-tab .layui-tab-content .layui-show"
                        ));
                        if ((index2 == 0 && date_1 == "") || (index2 == 1 && date_2 == "")) {
                            layer.msg('请输入日期', {
                                icon: 2,
                                time: 1000
                            });
                        } else if (time == "") {
                            layer.msg('请输入时间', {
                                icon: 2,
                                time: 1000
                            });
                        } else {
                            autoMation.addtimeitem(date_1, date_2, time);
                            layer.close(index);
                            DivHide();
                        }
                    },
                    btn2: function (index, layero) {
                        DivHide();
                        //$("#areaplus").fadeOut();
                    },
                    cancel: function () {
                        DivHide();
                    },
                    success: function () {
                        //添加时间条件-日期类型 tab
                        $(".add_time .layui-form .layui-tab .layui-tab-title li").on('click',
                            function () {
                                $(".add_time .layui-form .layui-tab .layui-tab-content .layui-tab-item")
                                    .eq($(this).index()).addClass("layui-show").siblings()
                                    .removeClass("layui-show");
                                if ($(this).index() == 0) {
                                    $("#date_3").val("");
                                    $("#date_4").val("");
                                }
                                if ($(this).index() == 1) {
                                    $("#date_1").val("");
                                    $("#date_2").val("");
                                }
                            })
                    }
                });
                laydate.render({
                    elem: '#date_1',
                    theme: '#389bff',
                    change: function (value, date, endDate) {
                        date_1 = value;
                    },
                    done: function (value, date, endDate) {
                        date_1 = value;
                    }
                });
                laydate.render({
                    elem: '#date_2',
                    type: 'time',
                    theme: '#389bff',
                    change: function (value, date, endDate) {
                        time = value;
                    },
                    done: function (value, date, endDate) {
                        time = value;
                    }
                });
                laydate.render({
                    elem: '#date_3',
                    range: true,
                    theme: '#389bff',
                    change: function (value, date, endDate) {
                        date_2 = value;
                    },
                    done: function (value, date, endDate) {
                        date_2 = value;
                    }
                });
                laydate.render({
                    elem: '#date_4',
                    type: 'time',
                    theme: '#389bff',
                    change: function (value, date, endDate) {
                        time = value;
                    },
                    done: function (value, date, endDate) {
                        time = value;
                    }
                });
            }
        },
        SetLandSelect: function (type, model) {
            var option = [];
            if (type == "trigger") {
                option.push("<option value=\"\">直接选择或搜索选择</option>");
                $.each(autoMation.DeviceList, function (index, item) {
                    var count = 0;
                    $.each(item.Devices, function (index2, item2) {
                        if (automationInfo.DevName == "" || automationInfo.DevName == item2.Number) {
                            count++;
                        }
                    })
                    if (count == item.Devices.length) {
                        if (model && item.LandID == model.LandID) {
                            option.push("<option value=\"" + item.LandID + "\" selected>" + item
                                .LandName + "</option>");
                        } else {
                            option.push("<option value=\"" + item.LandID + "\">" + item.LandName +
                                "</option>");
                        }
                    }
                });
                $("#area").find("option").remove();
                $("#area").append(option.join());
                form.render('select', 'test1');
            } else {


            }
        },
        SetDeviceSelect: function (type, model, id) {
            var option = [];
            if (type == "trigger") {
                option.push("<option value=\"\">直接选择或搜索选择</option>");
                $.each(autoMation.DeviceList, function (index, item) {
                    if (item.LandID == id) {
                        $.each(item.Devices, function (index2, item2) {
                            if (item2.Category != "INTEGRATED") {
                                if (automationInfo.DevName == "" || automationInfo.DevName == item2
                                    .Number) {
                                    if (model && item2.DeviceID == model.DeviceID) {
                                        option.push("<option value=\"" + item2.DeviceID +
                                            "\" selected>" + item2.DeviceName + "</option>");
                                    } else {
                                        option.push("<option value=\"" + item2.DeviceID +
                                            "\">" + item2.DeviceName + "</option>");
                                    }
                                }
                            }
                        });
                    }
                });
                $("#device").find("option").remove();
                $("#device").append(option.join());
                form.render('select', 'test2');
            } else {


            }
        },
        SetSlotSelect: function (type, model, id, layuiobj) {
            var data = 0;
            if (model) {
                data = model.Data;
            }
            // console.log(model);
            var option = [];
            if (type == "trigger") {
                option.push("<option value=\"\">直接选择或搜索选择</option>");
                $.each(autoMation.DeviceList, function (index, item) {
                    $.each(item.Devices, function (index2, item2) {
                        if (item2.DeviceID == id) {
                            $.each(item2.Slots, function (index3, item3) {
                                if (model && item3.Slot == model.SlotID) {
                                    option.push("<option value=\"" + item3.Slot +
                                        "\" selected>" + item3.SensorName +
                                        "</option>");
                                } else {
                                    option.push("<option value=\"" + item3.Slot +
                                        "\">" + item3.SensorName + "</option>");
                                }
                            });
                            var layerH = 0;
                            if (item2.Category == 'CONTROLLER') {
                                $('.equipment-content1').css('display', 'block');
                                $('.equipment-content2').css('display', 'none');
                                layerH = ($(window).height() - 468) / 2;
                                if (item2.DeviceTypeID == 13 || item2.DeviceTypeID == 4001) {
                                    $(".button").find("button").eq(2).show();
                                } else if (item2.DeviceTypeID == 14 || item2.DeviceTypeID ==
                                    4002) {
                                    $(".button").find("button").eq(2).hide();
                                }
                                $(".button").find("button").removeClass("selected");
                                $(".button").find("button").eq(data).addClass("selected");
                            } else if (item2.Category == 'SENSOR') {
                                $('.equipment-content1').css('display', 'none');
                                $('.equipment-content2').css('display', 'block');
                                layerH = ($(window).height() - 603) / 2;
                                if (model) {
                                    autoMation.SetSection(model.EnableHigh, model.HighValue,
                                        model.EnableLow, model.LowValue);
                                }

                            } else {
                                $('.equipment-content1').css('display', 'none');
                                $('.equipment-content2').css('display', 'none');
                                layerH = ($(window).height() - 357) / 2;
                            }
                            layer.style(layuiobj, {
                                top: layerH
                            });
                        }
                    });
                });
                $("#slot").find("option").remove();
                $("#slot").append(option.join());
                form.render('select', 'slot');
            } else {


            }
        },
        //新增设备触发条件列
        addequipitem: function (obj, LandID, DeviceID, SlotID, data) {
            var temp = {};
            var landName = "";
            var deviceName = "";
            var sensorName = "";
            var category = "";
            $.each(autoMation.DeviceList, function (index, item) {
                if (item.LandID == LandID) {
                    landName = item.LandName;
                    $.each(item.Devices, function (index2, item2) {
                        if (item2.DeviceID == DeviceID) {
                            deviceName = item2.DeviceName;
                            category = item2.Category;
                            automationInfo.DevName = item2.Number;
                            $.each(item2.Slots, function (index3, item3) {
                                if (item3.Slot == SlotID) {
                                    sensorName = item3.SensorName;
                                }
                            })
                        }
                    });
                }
            });
            var sort = $('.factor_after li').index($(obj).closest("li"));

            var condition = "";
            if (data == 0) {
                condition = "开";
            } else if (data == 1) {
                condition = "关";
            } else {
                condition = "停";
            }
            var equiptriggerobj;

            if (category == 'CONTROLLER') {
                equiptriggerobj = $("<li class='clearfix' category='CONTROLLER'>" +
                    "<div class='left fl temper_ico'></div>" +
                    "<div class='center fl'>" +
                    "<p>" + condition + "</p>" +
                    "<p><span>" + deviceName + "</span>" +
                    "<span>" + sensorName + "</span>" +
                    "<span>" + landName + "</span></p></div>" +
                    "<div class='right fr clearfix'><span class='edit fl' onclick=\"autoMation.DeviceTrigger(this,'trigger')\" title='编辑'></span><span class='del fl' onclick='autoMation.deletetimefn(this)' title='删除'></span></div></li>"
                );
                temp = {
                    "Data": data,
                    "LandID": LandID,
                    "DeviceID": DeviceID,
                    "SlotID": SlotID,
                    "Category": category
                };
                //autoMation.TriggerList.push({ "Data": data, "LandID": LandID, "DeviceID": DeviceID, "SlotID": SlotID, "Category": category });
            } else if (category == 'SENSOR') {
                condition = "";
                var EnableHigh, HighValue, EnableLow, LowValue;
                var index = $(".equipment-content2 .layui-tab-item").index($(
                    ".equipment-content2 .layui-show"));
                var value1 = $(".equipment-content2 .layui-show").find("input").eq(0).val();
                var value2 = $(".equipment-content2 .layui-show").find("input").eq(1).val();
                switch (index) {
                    case 0:
                        EnableHigh = true;
                        HighValue = value1;
                        EnableLow = false;
                        LowValue = null;
                        condition = condition + "＞" + value1 + "触发";
                        break;
                    case 1:
                        EnableHigh = false;
                        HighValue = null;
                        EnableLow = true;
                        LowValue = value1;
                        condition = condition + "＜" + value1 + "触发";
                        break;
                    case 2:
                        EnableHigh = true;
                        HighValue = value1;
                        EnableLow = true;
                        LowValue = value2;
                        condition = condition + value1 + "＜x＜" + value2 + "触发";
                        break;
                    case 3:
                        EnableHigh = true;
                        HighValue = value1;
                        EnableLow = true;
                        LowValue = value1;
                        condition = condition + "＝" + value1 + "触发";
                        break;
                    case 4:
                        EnableHigh = true;
                        HighValue = value2;
                        EnableLow = true;
                        LowValue = value1;
                        condition = condition + "＞" + value2 + "或＜" + value1 + "触发";
                        break;
                }
                equiptriggerobj = $("<li class='clearfix' category='SENSOR'>" +
                    "<div class='left fl temper_ico'></div>" +
                    "<div class='center fl'>" +
                    "<p>" + condition + "</p>" +
                    "<p><span>" + deviceName + "</span>" +
                    "<span>" + sensorName + "</span>" +
                    "<span>" + landName + "</span></p></div>" +
                    "<div class='right fr clearfix'><span class='edit fl' onclick=\"autoMation.DeviceTrigger(this,'trigger')\" title='编辑'></span><span class='del fl' onclick='autoMation.deletetimefn(this)' title='删除'></span></div></li>"
                );
                //autoMation.TriggerList.push({ "Data": data, "LandID": LandID, "DeviceID": DeviceID, "SlotID": SlotID, "Category": category, "EnableHigh": EnableHigh, "HighValue": HighValue, "EnableLow": EnableLow, "LowValue": LowValue });
                temp = {
                    "Data": data,
                    "LandID": LandID,
                    "DeviceID": DeviceID,
                    "SlotID": SlotID,
                    "Category": category,
                    "EnableHigh": EnableHigh,
                    "HighValue": HighValue,
                    "EnableLow": EnableLow,
                    "LowValue": LowValue
                };
            }
            //console.log(equiptriggerobj.html());
            if (sort == -1) {
                autoMation.TriggerList.push(temp);
                $(".list_wrap .factor_after").append(equiptriggerobj);
            } else {
                autoMation.TriggerList.splice(sort, 1, temp);
                $('.factor_after li').eq(sort).html(equiptriggerobj.html());
            }

            //是否添加继续添加按钮
            $(".option .opt_before").hide();
            if (!$(".list_wrap .continue").is(':visible')) {
                $(".list_wrap .continue").show();
            }
            if ($(".list_wrap ul.factor_after li.clearfix").length >= 2) {
                $(".option .sub_tit form.conditions").show();
            }
            //选择设备触发条件 显示有效时间
            $(".period").show();
        },
        SetSection: function (EnableHigh, HighValue, EnableLow, LowValue) {
            $(".add_equipment .equipment-content2 .layui-tab-title li").removeClass("layui-this selected").find(
                "img.rec").hide();
            $(".add_equipment .equipment-content2 .layui-tab-content .layui-tab-item").removeClass(
                "layui-show");
            if (EnableHigh == true && HighValue != null && EnableLow == false && LowValue == null) {
                $(".add_equipment .equipment-content2 .layui-tab-title li").eq(0).addClass(
                    "layui-this selected").find("img.rec").show();
                $(".add_equipment .equipment-content2 .layui-tab-content .layui-tab-item").eq(0).addClass(
                    "layui-show");
                $(".equipment-content2 .layui-show").find("input").eq(0).val(HighValue);
            } else if (EnableHigh == false && HighValue == null && EnableLow == true && LowValue != null) {
                $(".add_equipment .equipment-content2 .layui-tab-title li").eq(1).addClass(
                    "layui-this selected").find("img.rec").show();
                $(".add_equipment .equipment-content2 .layui-tab-content .layui-tab-item").eq(1).addClass(
                    "layui-show");
                $(".equipment-content2 .layui-show").find("input").eq(0).val(LowValue);
            } else if (EnableHigh == true && HighValue != null && EnableLow == true && LowValue != null &&
                HighValue < LowValue) {
                $(".add_equipment .equipment-content2 .layui-tab-title li").eq(2).addClass(
                    "layui-this selected").find("img.rec").show();
                $(".add_equipment .equipment-content2 .layui-tab-content .layui-tab-item").eq(2).addClass(
                    "layui-show");
                $(".equipment-content2 .layui-show").find("input").eq(0).val(HighValue);
                $(".equipment-content2 .layui-show").find("input").eq(1).val(LowValue);
            } else if (EnableHigh == true && HighValue != null && EnableLow == true && LowValue != null &&
                HighValue == LowValue) {
                $(".add_equipment .equipment-content2 .layui-tab-title li").eq(3).addClass(
                    "layui-this selected").find("img.rec").show();
                $(".add_equipment .equipment-content2 .layui-tab-content .layui-tab-item").eq(3).addClass(
                    "layui-show");
                $(".equipment-content2 .layui-show").find("input").eq(0).val(HighValue);
            } else if (EnableHigh == true && HighValue != null && EnableLow == true && LowValue != null &&
                HighValue > LowValue) {
                $(".add_equipment .equipment-content2 .layui-tab-title li").eq(4).addClass(
                    "layui-this selected").find("img.rec").show();
                $(".add_equipment .equipment-content2 .layui-tab-content .layui-tab-item").eq(4).addClass(
                    "layui-show");
                $(".equipment-content2 .layui-show").find("input").eq(0).val(LowValue);
                $(".equipment-content2 .layui-show").find("input").eq(1).val(HighValue);
            }
        },
        //删除时间、触发条件 列
        deletetimefn: function (obj) {
            layer.confirm('您确定删除该触发条件吗？', {
                title: '温馨提示'
            }, function (index) {
                // console.log("<<<<<<<<<<<>>>>>>>>>>>>>")
                // console.log(obj);
                var sort = $('.factor_after li').index($(obj).closest("li"));
                autoMation.TriggerList.splice(sort, 1);
                if ($(obj).closest('ul.factor_after').length == 1) {
                    if ($(obj).closest('ul.factor_after').find('li.clearfix').length <= 1) {
                        $('.list_wrap .continue,.period').hide();
                        $(".option .opt_before").show();
                    } else if ($(obj).closest('ul.factor_after').find('li.clearfix').length == 2) {
                        $(".option .sub_tit form.conditions").hide();
                    }
                    $(obj).closest('li.clearfix').remove();
                } else {
                    $(obj).closest('li.clearfix').remove();
                    $(".option .opt_before").show();
                }
                if ($('ul.factor_after').find('li.clearfix').length == 0) {
                    automationInfo.DevName = "";
                    //$(".operate_before li").addClass("hidden");
                    // $('ul.operate_before').find('li,clearfix').remove();
                    //$(".operate .continue").hide();
                    //$(".operate .operate_before li").removeClass("hidden");
                }
                layer.close(index);
            });
        },
        //增加时间条件列
        addtimeitem: function (date_1, date_2, time) {
            var index = 0;
            var value = "";
            if (date_1 == '') {
                value = date_2;
                index = 1;
            } else {
                index = 0;
                value = date_1;
            }
            if (date_1 == "" && date_2 == "") {
                layer.msg('请输入日期', {
                    icon: 2,
                    time: 1500
                });
            }
            var timertriggerobj = $(
                "<li category='time_trigger' class='clearfix'><div class='left fl time_ico'></div><div class='center fl'>" +
                "<p>" + value + "</p>" +
                "<p>" + time + "</p> " +
                "</div><div class='right fr clearfix'>" +
                "<span class='edit fl' onclick=\"autoMation.DeviceTrigger(this,'time')\" title='编辑'></span>" +
                "<span class='del fl' onclick='autoMation.deletetimefn(this)' title='删除'></span></div></li>"
            );
            var temp = {
                "Category": "Time",
                "value1": date_1,
                "value2": date_2,
                "type": index,
                "time": time
            };
            if ($(".list_wrap .time_after").find("li.clearfix").length == 0) { //新增
                autoMation.TriggerList.push(temp);
                $(".list_wrap .time_after").append(timertriggerobj);
            } else { //替换
                autoMation.TriggerList.splice(0, 1, temp);
                $('.time_after li').eq(0).html(timertriggerobj.html());
            }
            $(".option .opt_before").hide();
        }
    }
    //自动化列表页与添加页的切换；




    // //点击搜索icon按钮触发
    // function btnsearch() {
    //     GetAutomationList(0);
    // };

    //获取自动化列表
</script>

<!---—————————————————————————— 新增自动化 start————————————————————————-->

<style>
    .auto_add {
        display: none;
    }

    .time {
        position: inherit;
    }

    .clearfix:before {
        *zoom: 1;
    }

    .clearfix:before,
    .clearfix:after {
        display: table;
        line-height: 0;
        content: '';
    }

    .clearfix:after {
        clear: both;
    }

    .pr {
        position: relative;
    }

    .pa {
        position: absolute;
    }

    .fl {
        float: left;
    }

    .fr {
        float: right;
    }

    .hidden {
        display: none;
    }

    ::-ms-clear {
        display: none;
    }

    ::-ms-reveal {
        display: none;
    }

    input[required]:invalid,
    input:focus:invalid,
    textarea[required]:invalid,
    textarea:focus:invalid {
        box-shadow: none;
    }

    .za_conmian {
        box-sizing: border-box;
    }

        .za_conmian .auto {
            padding-bottom: 40px;
        }

    .auto .title div {
        height: 18px;
        line-height: 18px;
        margin-top: 10px;
        font-size: 14px;
        border-left: 2px solid #389BFF;
        padding-left: 12px;
    }

    .autoSearch {
        background: #C0C0C0;
    }

    .auto .sub_tit {
        height: 40px;
        line-height: 40px;
        font-size: 14px;
    }

    .auto .sub_titR {
        line-height: 40px;
        font-size: 14px;
    }

        .auto .sub_titR input {
            padding-left: 10px;
            border: 1px solid #c2c2c2;
        }

        .auto .sub_titR span {
            display: inline-block;
            line-height: 30px;
            width: 40px;
            margin-left: 15px;
            background: #1E9FFF;
            ;
            color: #fff;
            white-space: nowrap;
            text-align: center;
            font-size: 14px;
            border: none;
            border-radius: 2px;
            cursor: pointer;
            opacity: .9
        }


    .layui-form-item {
        margin-bottom: 0;
    }

        .layui-form-item .layui-input-inline {
            width: 338px;
            margin-right: 0;
        }

        .layui-form-item .layui-form-radio:last-child {
            margin-right: 0;
            padding-right: 0;
        }

    .layui-form-radio i {
        font-size: 18px;
    }

    .layui-form-radio > span {
        vertical-align: -4px;
    }

        .layui-form-radio > span > span {
            vertical-align: 0px;
        }

    .layui-form-radio i:hover,
    .layui-form-radioed i {
        color: #389bff;
    }

    .auto_name {
        margin: 10px 0 0 14px;
    }

        .auto_name input {
            width: 390px;
            height: 28px;
            border: 1px solid #c2c2c2;
            border-radius: 3px;
            padding-left: 10px;
            margin-top: 3px;
        }

    .time_ico {
        background: url('../../images/automation/opt_clock.png')no-repeat center;
    }

    .air_ico {
        background: url('../../images/automation/opt_air.png')no-repeat center;
    }

    .temper_ico {
        background: url('../../images/automation/opt_temper.png')no-repeat center;
    }

    .fan_ico {
        background: url('../../images/automation/opt_fan.png')no-repeat center;
    }

    .option {
        margin: 10px 0 0 14px;
    }

    .opt_before {
        margin-bottom: 10px;
    }

    .option .opt_before li,
    .operate .operate_before li {
        cursor: pointer;
        float: left;
        width: 390px;
        height: 100px;
        padding: 20px;
        box-sizing: border-box;
        border: 1px solid #c2c2c2;
        background: url('../../images/automation/add_big.png')no-repeat 340px center;
        margin-top: 10px;
    }

        .option .opt_before li.time {
            margin-right: 20px;
        }

        .option .opt_before li .option_tit,
        .operate .operate_before li .operate_tit {
            color: #389bff;
            font-size: 16px;
            padding-left: 40px;
            height: 32px;
            line-height: 32px;
        }

        .option .opt_before li.time .option_tit {
            background: url('../../images/automation/clock.png')no-repeat left center;
        }

        .option .opt_before li.factor .option_tit {
            background: url('../../images/automation/equip.png')no-repeat left center;
        }

    .operate ul li .operate_tit {
        background: url('../../images/automation/plan.png')no-repeat left center;
    }

    .option .opt_before li .option_des,
    .operate .operate_before li .operate_des {
        color: #c2c2c2;
        font-size: 12px;
        padding-left: 40px;
        height: 24px;
        line-height: 24px;
    }

    .option .time_after {
        overflow: auto
    }

        .option .time_after li {
            height: 100px;
            padding: 20px 10px 20px 20px;
            margin-bottom: 10px;
            box-sizing: border-box;
            border: 1px solid #c2c2c2;
            margin-top: 6px;
            width: 100%;
        }

            .option .time_after li .left {
                width: 60px;
                height: 60px;
                margin-right: 20px;
            }

            .option .time_after li .center {
                height: 60px;
            }

                .option .time_after li .center p {
                    height: 25px;
                    line-height: 30px;
                }

                    .option .time_after li .center p:first-child {
                        font-size: 16px;
                        color: #389bff;
                        width: 240px;
                    }

                    .option .time_after li .center p:last-child {
                        font-size: 14px;
                        color: #000;
                    }

            .option .time_after li > div {
                width: 14%;
                height: 61px;
            }

            .option .time_after li .right span {
                cursor: pointer;
                width: 38px;
                height: 60px;
            }

            .option .time_after li .right .edit {
                background: url('../../images/automation/edit.png')no-repeat center;
            }

            .option .time_after li .right .del {
                background: url('../../images/automation/delete.png')no-repeat center;
            }

    .option .factor_after li {
        height: 100px;
        width: 100%;
        padding: 20px 10px 20px 20px;
        box-sizing: border-box;
        border: 1px solid #c2c2c2;
        margin: 10px 0 15px 0;
    }

        .option .factor_after li .left {
            width: 60px;
            height: 60px;
            margin-right: 20px;
        }

        .option .factor_after li .center {
            height: 60px;
        }

            .option .factor_after li .center p {
                height: 25px;
                line-height: 30px;
            }

                .option .factor_after li .center p:first-child {
                    font-size: 16px;
                    color: #389bff;
                }

                .option .factor_after li .center p:last-child {
                    font-size: 14px;
                    color: #000;
                }

                    .option .factor_after li .center p:last-child span {
                        margin-right: 10px;
                    }

                        .option .factor_after li .center p:last-child span:last-child {
                            color: #c2c2c2;
                        }

        .option .factor_after li .right span {
            cursor: pointer;
            width: 38px;
            height: 60px;
        }

        .option .factor_after li .right .edit {
            background: url('../../images/automation/edit.png')no-repeat center;
        }

        .option .factor_after li .right .del {
            background: url('../../images/automation/delete.png')no-repeat center;
        }

    .continue {
        cursor: pointer;
        font-size: 14px;
        color: #389bff;
        line-height: 12px;
        background: url('../../images/automation/continue.png')no-repeat left bottom;
        padding-left: 20px;
        margin-top: 10px;
    }

    .list_wrap .continue {
        display: none;
    }

    .operate .continue {
        display: none;
    }

    .operate {
        margin: 10px 0 0 14px;
    }

    .operate_before {
        margin-bottom: 10px;
    }

    .operate_after li {
        width: 100%;
        height: 100px;
        padding: 20px 10px 20px 20px;
        margin-bottom: 6px;
        box-sizing: border-box;
        border: 1px solid #c2c2c2;
        position: relative;
    }

        .operate_after li .left {
            width: 60px;
            height: 60px;
            margin-right: 20px;
        }

        .operate_after li .center {
            height: 60px;
        }

            .operate_after li .center p {
                height: 25px;
                line-height: 30px;
            }

                .operate_after li .center p:first-child {
                    font-size: 16px;
                    color: #389bff;
                }

                    .operate_after li .center p:first-child span:first-child {
                        display: inline-block;
                        width: 160px;
                        height: 25px;
                    }

                    .operate_after li .center p:first-child span:last-child {
                        color: #c2c2c2;
                        display: inline-block;
                    }

                .operate_after li .center p:last-child {
                    font-size: 14px;
                    color: #000;
                }

                    .operate_after li .center p:last-child span {
                        margin-right: 10px;
                        display: inline-block;
                        width: 120px;
                    }

                        .operate_after li .center p:last-child span:last-child {
                            color: #c2c2c2;
                        }

                .operate_after li .center p.onep {
                    margin-top: 16px;
                }

        .operate_after li .right {
            width: 20%;
            float: right;
        }

            .operate_after li .right span {
                cursor: pointer;
                width: 38px;
                height: 60px;
            }

            .operate_after li .right .up {
                width: 28px;
                background: url('../../images/automation/up_arrow_active.png')no-repeat center;
            }

                .operate_after li .right .up.disable {
                    background: url('../../images/automation/up_arrow.png')no-repeat center;
                }

            .operate_after li .right .down {
                width: 34px;
                background: url('../../images/automation/down_arrow_active.png')no-repeat center;
            }

                .operate_after li .right .down.disable {
                    background: url('../../images/automation/down_arrow.png')no-repeat center;
                }

            .operate_after li .right .edit {
                background: url('../../images/automation/edit.png')no-repeat center;
            }

            .operate_after li .right .del {
                background: url('../../images/automation/delete.png')no-repeat center;
            }

    .rank {
        top: 0;
        left: 0;
        width: 36px;
        height: 36px;
        line-height: 22px;
        padding-left: 5px;
        box-sizing: border-box;
        text-align: left;
        background: url('../../images/automation/rank_bg.png')no-repeat top left;
    }

    .period {
        margin: 9px 0 9px 14px;
        display: none;
    }

        .period .layui-form,
        .period .layui-form-item {
            display: inline-block;
        }

            .period .layui-form.fl .layui-form-item .layui-input-inline {
                width: 300px;
            }

            .period .layui-form.time_range .layui-form-item .layui-input-inline {
                width: 145px;
            }

        .period .custom_time {
            height: 38px;
            line-height: 40px;
            font-size: 14px;
            margin-left: 8px;
        }

    input#time_box {
        height: 30px;
        line-height: 30px;
        margin-top: 3px;
    }

    .switch {
        margin: 8px 0 10px 14px;
    }

    .auto_add .layui-form-switch {
        width: 60px;
        height: 28px;
        border: 1px solid #c2c2c2;
        margin-top: 0;
    }

        .auto_add .layui-form-switch i {
            top: 4.5px;
            left: 5.5px;
            width: 18px;
            height: 18px;
            background: #c2c2c2;
        }

        .auto_add .layui-form-switch em {
            width: 30px;
            font-size: 14px;
            top: 3px;
            left: auto;
            right: 10px;
            color: #c2c2c2 !important;
        }

    .auto_add .layui-form-onswitch {
        border: 1px solid #389bff;
        background: none;
    }

        .auto_add .layui-form-onswitch i {
            left: 66px;
            background: #389bff;
        }

        .auto_add .layui-form-onswitch em {
            width: 30px;
            font-size: 14px;
            top: 3px;
            left: 10px;
            right: auto;
            color: #389bff !important;
        }

    .submit {
        margin: 10px 0 0 14px;
        padding-top: 10px;
    }

    .layui-btn {
        height: 30px;
        line-height: 29px;
        padding: 0 25px;
    }

    .layui-btn-primary {
        color: #c2c2c2;
    }

    .option .sub_tit form.conditions {
        display: none;
    }

    .layui-form-select dl dd.layui-this {
        background-color: #389bff;
    }

    .color {
        color: #389bff !important;
        border-color: #389bff !important;
    }

    .layui-laydate-content td.laydate-selected {
        background-color: #eee !important;
    }

    .add_time {
        height: 160px;
        padding-top: 5px;
        display: none;
    }

        .add_time .layui-tab-title li {
            position: static !important;
            line-height: 0;
            padding: 0 15px 0 0;
        }

        .add_time .layui-tab-content {
            width: 410px;
            height: 80px;
            border: 1px solid #eee;
            margin: 0 auto 20px;
            padding: 20px;
        }

            .add_time .layui-tab-content .layui-tab-item {
                margin-left: 25px;
            }

            .add_time .layui-tab-content .layui-inline input {
                height: 29px;
                line-height: 29px;
                width: 149px;
            }

            .add_time .layui-tab-content .layui-inline .layui-form-label {
                font-size: 14px;
                color: #999;
                padding: 5px 15px;
            }

            .add_time .layui-tab-content .layui-inline:nth-child(1) {
                margin: 0 0 20px;
            }

            .add_time .layui-tab-content .range input {
                width: 134%;
            }

    .add_operation {
        height: 280px;
        display: none;
    }

        .add_operation .layui-tab-title li {
            position: static !important;
            line-height: 0;
            padding: 0 10px 0 0;
        }

        .add_operation .layui-tab-content {
            width: 520px;
            height: 200px;
            border: 1px solid #eee;
            margin: 0 auto 0;
            padding: 20px;
        }

            .add_operation .layui-tab-content .equipment .layui-inline input {
                height: 29px;
                width: 355px;
                line-height: 29px;
            }

            .add_operation .layui-tab-content .equipment .eq-control {
                margin-right: 12px;
            }

            .add_operation .layui-tab-content .equipment .layui-inline:nth-child(2) input {
                height: 69px;
                width: 355px;
            }

            .add_operation .layui-tab-content .equipment .layui-inline:nth-child(4) input {
                height: 29px;
                width: 170px;
                display: inline-block;
            }

            .add_operation .layui-tab-content .equipment .layui-inline:nth-child(4) .delay-time {
                position: relative;
            }

                .add_operation .layui-tab-content .equipment .layui-inline:nth-child(4) .delay-time::after {
                    content: "分钟";
                    position: absolute;
                    top: 6px;
                    right: 7px;
                }

            .add_operation .layui-tab-content .equipment .layui-inline:nth-child(4) .layui-input-block:nth-child(3) {
                margin-left: 0;
            }

            .add_operation .layui-tab-content .equipment .layui-inline span.hint { /* display: inline-block; */
                width: 16px;
                height: 16px;
                background: url(../../images/automation/help.png) center center no-repeat;
                margin: 7px 0px 0px 8px;
                cursor: pointer;
                float: right;
            }

        .add_operation .other {
            margin-top: 40px;
        }

            .add_operation .other .layui-inline {
                margin-bottom: 20px;
                height: 30px;
            }

                .add_operation .other .layui-inline .layui-form-label {
                    height: 30px;
                    font-size: 14px;
                    color: #999;
                    padding: 4px 15px;
                }

                .add_operation .other .layui-inline input {
                    height: 29px;
                    line-height: 29px;
                }

                .add_operation .other .layui-inline:nth-child(1) input {
                    width: 355px;
                    height: 30px;
                    line-height: 30px;
                }

                .add_operation .other .layui-inline:nth-child(1) {
                    margin-bottom: 20px;
                }

        .add_operation .time {
            position: relative;
            margin: 80px auto;
        }

            .add_operation .time input {
                width: 350px;
                height: 30px;
                line-height: 30px;
            }

            .add_operation .time .delay-time::after {
                content: '分钟';
                position: absolute;
                top: 6px;
                right: 70px;
            }

    .add_equipment {
        width: 550px;
        padding: 20px 0px;
        display: none;
    }

        .add_equipment .equipment {
            margin-bottom: 10px;
        }

            .add_equipment .equipment .layui-inline input {
                height: 29px;
                width: 400px;
                line-height: 29px;
            }

            .add_equipment .equipment .layui-inline:nth-child(3) input {
                height: 69px;
                width: 400px;
            }

        .add_equipment h2 {
            text-align: center;
            color: #000;
            margin: 0 auto 20px;
        }

        .add_equipment .equipment-content1 {
            font-size: 18px;
        }

            .add_equipment .equipment-content1 h2::before {
                width: 160px;
            }

            .add_equipment .equipment-content1 .button {
                width: 314px;
                margin: 0 auto;
            }

                .add_equipment .equipment-content1 .button button {
                    width: 90px;
                    height: 70px;
                    color: #a8a8a8;
                    position: relative;
                    border-color: #e5e5e5;
                    margin: 0 5px;
                }

                    .add_equipment .equipment-content1 .button button.selected {
                        border-color: #5fafff;
                        color: #5fafff;
                    }

                        .add_equipment .equipment-content1 .button button.selected::after {
                            content: url('../../images/automation/select (2).png');
                            position: absolute;
                            top: -6px;
                            right: 0;
                        }

            .add_equipment .equipment-content1 .layui-btn-primary:hover {
                color: #389bff !important;
                border-color: #389bff;
            }

        .add_equipment .equipment-content2 {
            width: 474px;
            font-size: 14px;
            color: #E5E5E5;
            padding-left: 38px;
        }

            .add_equipment .equipment-content2 h2::before {
                width: 160px;
            }

            .add_equipment .equipment-content2 .layui-tab-title .layui-this:after {
                border: 1px solid #389bff;
                height: 73px;
                border-bottom: none;
            }

            .add_equipment .equipment-content2 .layui-tab-title {
                border-bottom: 1px solid #389bff;
                height: 77px;
                transition: all 0 !important;
            }

                .add_equipment .equipment-content2 .layui-tab-title li {
                    text-align: center;
                    height: 70px;
                    width: 90px;
                    margin-right: 6px;
                    border: 1px solid #e5e5e5;
                    box-sizing: border-box;
                    line-height: 36px;
                    color: #999;
                    font-size: 13px;
                    position: relative;
                    padding: 0;
                }

                    .add_equipment .equipment-content2 .layui-tab-title li.selected::before {
                        content: url('../../images/automation/select (2).png');
                        position: absolute;
                        top: -7px;
                        right: 1px;
                    }

                    .add_equipment .equipment-content2 .layui-tab-title li img:nth-child(1) {
                        padding-top: 5px;
                    }

                    .add_equipment .equipment-content2 .layui-tab-title li .rec {
                        display: none;
                        z-index: 99;
                        height: 5px;
                        width: 100%;
                    }

            .add_equipment .equipment-content2 .layui-tab-content {
                border: 1px solid #389bff;
                border-top: none;
                width: 472px;
                padding: 0;
            }

            .add_equipment .equipment-content2 .layui-tab-title .layui-this {
                border: none;
                border-top: 1px solid #fff;
                color: #389bff;
            }

            .add_equipment .equipment-content2 .layui-tab-bar {
                position: static !important;
                display: none;
            }

            .add_equipment .equipment-content2 .layui-tab[overflow] > .layui-tab-title {
                overflow: inherit;
            }

            .add_equipment .equipment-content2 .layui-tab-content .layui-tab-item img {
                text-align: center;
                margin-top: 27px;
            }

            .add_equipment .equipment-content2 .layui-tab-content .layui-tab-item input {
                width: 60px;
                height: 20px;
                border-radius: 2px;
                color: #389bff;
                display: inline-block;
                font-size: 12px;
                padding-left: 2px;
                border-color: #c2c2c2;
                line-height: 21px;
                text-align: center;
            }

            .add_equipment .equipment-content2 .layui-tab-content .layui-tab-item {
                text-align: center;
                height: 128px;
            }

                .add_equipment .equipment-content2 .layui-tab-content .layui-tab-item > div {
                    display: inline-block;
                    text-align: center;
                    color: #999;
                    margin: 11px 37px 14px 23px;
                }

    .add_time .layui-tab-content .layui-inline #date_1 {
        background: url(../../images/automation/calender.png) no-repeat 120px 4px;
    }

    .add_time .layui-tab-content .layui-inline #date_2 {
        background: url(../../images/automation/time.png) no-repeat 120px 4px;
    }

    .add_time .layui-tab-content .layui-inline #date_3 {
        background: url(../../images/automation/calender.png) no-repeat 190px 4px;
    }

    .add_time .layui-tab-content .layui-inline #date_4 {
        background: url(../../images/automation/time.png) no-repeat 190px 4px;
    }

    .add_equipment h2::before {
        display: inline-block;
        position: relative;
        top: -4px;
        right: 20px;
        content: "";
        width: 185px;
        height: 1px;
        background-color: #eee;
    }

    .add_equipment h2::after {
        display: inline-block;
        position: relative;
        top: -4px;
        left: 20px;
        content: ".";
        width: 185px;
        color: #fff;
        font-size: 0;
        height: 1px;
        background-color: #eee;
    }

    input {
        line-height: 29px;
    }

    .layui-laydate .layui-this,
    .add_time .layui-laydate .layui-this,
    .add_operation .layui-laydate .layui-this {
        background-color: #389bff !important;
    }

    .layui-laydate-footer span:hover,
    .add_time .layui-form-radio i:hover,
    .add_time .layui-form-radioed i,
    .add_operation .layui-form-radio i:hover,
    .add_operation .layui-form-radioed i,
    .add_operation .layui-form-radio i:hover,
    .add_time .layui-form-radioed i,
    .add_equipment .layui-form-radio i:hover,
    .add_equipment .layui-form-radioed i,
    .add_equipment .layui-form-radio i:hover,
    .add_time .layui-form-radioed i {
        color: #389bff !important;
    }

    .add_time .datetype,
    .add_operation .datetype,
    .add_equipment .datetype {
        text-align: left;
        color: #999;
        font-size: 14px;
        padding: 10px 0 10px 30px;
    }

    .add_time .layui-tab,
    .add_operation .layui-tab,
    .add_equipment .layui-tab {
        margin: 0;
    }

    .add_time .layui-form-radio i,
    .add_operation .layui-form-radio i,
    .add_equipment .layui-form-radio i {
        font-size: 18px;
        margin-top: 0px;
    }

    .add_time .layui-tab-title,
    .add_operation .layui-tab-title {
        border: none !important;
        position: static !important;
        height: 39px;
    }

        .add_time .layui-tab-title .layui-this,
        .add_operation .layui-tab-title .layui-this {
            border: none !important;
        }

    .add_time .layui-tab-content .layui-inline,
    .add_operation .layui-tab-content .layui-inline,
    .add_equipment .layui-inline {
        height: 30px;
        margin: 0 auto;
    }

    .add_operation .layui-tab-content .equipment .layui-input-block,
    .add_equipment .equipment .layui-input-block {
        display: inline-block;
        margin-left: 0;
    }

    .add_operation .layui-tab-content .equipment .layui-inline:nth-child(2) .layui-form-selected dl,
    .add_equipment .equipment .layui-inline:nth-child(3) .layui-form-selected dl {
        margin-top: 43px;
    }

    .add_operation .layui-tab-content .equipment .layui-inline .layui-form-label,
    .add_operation .time .layui-form-label,
    .add_equipment .equipment .layui-inline .layui-form-label {
        font-size: 14px;
        color: #999;
        padding: 4px 15px;
    }

    .add_operation .other .layui-inline:nth-child(1) .layui-form-selected dl {
        margin-top: 0px;
        top: 32px;
    }

    .layui-tab-content .layui-form-select dl {
        top: 32px;
    }

    .add_operation .layui-tab-content .equipment .layui-inline,
    .add_equipment .equipment .layui-inline {
        margin-bottom: 12px;
    }

        .add_operation .layui-tab-content .equipment .layui-inline:nth-child(2),
        .add_equipment .equipment .layui-inline:nth-child(3) {
            margin-bottom: 52px;
        }

    .add_operation .layui-tab-content .range input,
    .add_equipment .range input {
        width: 115%;
    }

    .equipment .layui-form-select dl {
        position: absolute;
        top: 30px;
        left: 0px;
        bottom: auto;
        height: 220px;
    }

    body .layui-layer-page .layui-layer-content {
        overflow: inherit;
    }

    .layui-btn,
    .layui-btn:hover {
        border-color: #ccc;
    }

    .layui-form-radio i {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        -webkit-font-smoothing: subpixel-antialiased;
        font-size: 18px;
    }
</style>
<!---——————————————————————————自动化 start————————————————————————-->
<div class="auto_add OutermostLayer">
    <div class="auto layui-form">
        <div class="title">
            <div>自动化设定</div>
        </div>
        <div class="auto_name">
            <p class="sub_tit">自动化名称</p>
            <input id="Name" type="text" val="" placeholder="请输入自动化名称" lay-verify="required">
        </div>
        <div class="option">
            <div class="sub_tit clearfix">
                <p class="fl">触发条件</p>
                <!-- 设备触发多条件时才显示 -->
                <form class="layui-form fr conditions" action="">
                    <div class="layui-form-item">
                        <div class="layui-input-inline clearfix" id="ConditionType">
                            <input lay-filter="ConditionType" class="fl" type="radio" name="option" value="AND"
                                   title="满足所有条件时触发">
                            <input lay-filter="ConditionType" class="fl" type="radio" name="option" value="OR"
                                   title="满足任一条件时触发" checked>
                        </div>
                    </div>
                </form>
            </div>
            <!-- 时间触发和设备触发二选一 -->
            <ul class="opt_before clearfix">
                <li class="time clearfix" onclick="autoMation.DeviceTrigger(this,'time')">
                    <p class="option_tit">添加时间触发条件</p>
                    <p class="option_des">只能添加一个</p>
                </li>
                <li class="factor clearfix" onclick="autoMation.DeviceTrigger(this,'trigger')">
                    <p class="option_tit">添加设备触发条件</p>
                    <p class="option_des">可添加多个</p>
                </li>
            </ul>
            <!-- 时间或者设备触发条件列表 -->
            <div class="list_wrap">
                <!-- 时间触发条件列表 -->
                <ul class="time_after"></ul>
                <!-- 设备触发条件列表 -->
                <ul class="factor_after"></ul>
                <div class="continue" onclick="autoMation.DeviceTrigger(this, 'trigger')">继续添加设备触发条件</div>
            </div>
        </div>
        <!-- 设置执行操作 -->
        <div class="operate">
            <p class="sub_tit">执行操作</p>
            <!-- <div class="sub_titR">
                <input type="text" placeholder="请输入搜索项" id="searchM">
                <span onclick="searchMohu()">搜索</span>
            </div> -->
            <div id="operateBox"></div>
            <!-- 未添加操作 -->
            <ul class="operate_before clearfix">
                <li class="clearfix" onclick="createOperate(this,'','','','',0,'','','','');">
                    <p class="operate_tit">添加执行操作</p>
                    <p class="operate_des">可添加多个</p>
                </li>
            </ul>
            <!-- 设置的操作列表 -->
            <ul class="operate_after clearfix"></ul>
            <div class="continue" onclick="createOperate(this,'','','','',0,'','','','');">继续添加执行操作</div>
        </div>
        <!-- 有效时间段设置 -->
        <div class="period">
            <p class="sub_tit">有效时间设置</p>
            <div class="clearfix">
                <form class="layui-form fl" action="">
                    <div class="layui-form-item">
                        <div class="layui-input-inline" id="DeviceTriggerCondition">
                            <input class="fl" checked type="radio" name="time" lay-filter="time" value="1"
                                   title="全天<span style='color:#c2c2c2;'>（00:00:00~23:59:59）</span>">
                            <!-- <input disabled class="fl" type="radio" name="time" lay-filter="time" value="2" title="自定义"> -->
                        </div>
                    </div>
                </form>
                <div class="custom_time fl hidden">
                    <div class="layui-form time_range">
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <div class="layui-input-inline">
                                    <input type="text" class="layui-input" id="time_box"
                                           placeholder="00:00:00-00:00:00 ">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 立即启用开关 -->
        <div class="switch">
            <p class="sub_tit">立即启用</p>
            <div>
                <form class="layui-form" action="">
                    <div class="layui-form-item">
                        <div class="layui-input-inline" id="onOff">
                            <input type="checkbox" name="open" checked="" lay-filter="switchTest" lay-skin="switch"
                                   lay-text="开启|关闭">
                        </div>
                    </div>
                </form>
                <!-- <div class="layui-form-item">
                    <label class="layui-form-label">开关-默认开</label>
                    <div class="layui-input-block">
                    <input type="checkbox" checked="" name="open" lay-skin="switch" lay-filter="switchTest" lay-text="ON|OFF">
                    </div>
                </div> -->
            </div>
        </div>
        <!-- 保存提交设置参数 -->
        <div class="submit layui-form-item btn">
            <button class="layui-btn layui-btn-normal sure" lay-submit lay-filter="autocontent" id="submit">保存</button>
            <button onclick="LoadAction('automaticMonitor',0)" class="layui-btn layui-btn-primary cancel"
                    style="padding:0 25px;float:inherit;width:inherit;">
                取消
            </button>
        </div>
    </div>
    <!---——————————————————————————自动化 end————————————————————————-->
    <!------------------------------------------------------添加时间条件------------------------------------------------------>
    <div class="add_time">
        <form class="layui-form" action="" lay-filter="formTest">
            <label class="layui-form-label datetype">日期类型</label>
            <div class="layui-tab">
                <ul class="layui-tab-title" style="float:inherit">
                    <li><input type="radio" name="time1" value="0" title="指定日期" checked=""></li>
                    <li><input type="radio" name="time1" value="1" title="指定时间段"></li>
                </ul>
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">
                        <div class="layui-inline">
                            <label class="layui-form-label">日期</label>
                            <div class="layui-input-inline">
                                <input type="text" class="layui-input" id="date_1" placeholder="请选择日期"
                                       autocomplete="off">
                                <!--<img src="images/calender.png"/>-->
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">时间</label>
                            <div class="layui-input-inline">
                                <input type="text" class="layui-input" id="date_2" placeholder="请选择时间"
                                       autocomplete="off">
                            </div>
                        </div>
                    </div>
                    <div class="layui-tab-item range">
                        <div class="layui-inline">
                            <label class="layui-form-label">日期范围</label>
                            <div class="layui-input-inline">
                                <input type="text" class="layui-input" id="date_3" placeholder=" 开始日期 - 结束日期"
                                       autocomplete="off">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">时间</label>
                            <div class="layui-input-inline">
                                <input type="text" class="layui-input" id="date_4" placeholder="请选择时间"
                                       autocomplete="off">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <!--------------------------添加设备触发条件---------------------------->
    <div class="add_equipment">
        <form class="layui-form" action="">
            <!--选择设备-->
            <div class="equipment">
                <!-- <h2>选择设备</h2> -->
                <div class="layui-inline">
                    <label class="layui-form-label">所属地块</label>
                    <div class="layui-input-inline layui-form" lay-filter="test1">
                        <select name="area" lay-verify="required" lay-search="" id="area" lay-filter='lay_area'>
                            <option value="">直接选择或搜索选择</option>
                        </select>
                    </div>
                </div>
                <div class="layui-inline pic">
                    <label class="layui-form-label">设备名称</label>
                    <div class="layui-input-inline layui-form" lay-filter="test2">
                        <select name="modules" lay-verify="required" lay-search="" lay-filter='equipment_name'
                                id="device">
                            <option value="">直接选择或搜索选择</option>
                        </select>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">设备通道</label>
                    <div class="layui-input-inline layui-form" lay-filter="slot">
                        <select name="modules" lay-verify="required" lay-search="" id="slot" lay-filter='slot'>
                            <option value="">直接选择或搜索选择</option>
                        </select>
                    </div>
                </div>
            </div>
            <!--设置触发条件-->
            <div class="equipment-content1" style="display: none;">
                <h2>设置触发条件</h2>
                <div class="button">
                    <button class="layui-btn layui-btn-primary layui-btn-big selected"
                            onclick="return false;">
                        开
                    </button>
                    <button class="layui-btn layui-btn-primary layui-btn-big" onclick="return false;">关</button>
                    <button class="layui-btn layui-btn-primary layui-btn-big" onclick="return false;">停</button>
                </div>
            </div>
            <div class="equipment-content2" style="display: none;">
                <h2>设置触发条件</h2>
                <div class="layui-tab">
                    <ul class="layui-tab-title">
                        <li class="layui-this selected">
                            <img src="../../images/automation/higher.png" /><br />高于某个值时<br /><img src="../../images/automation/rec.png" style="display: block;" / class="rec">
                        </li>
                        <li>
                            <img src="../../images/automation/lower.png" /><br />低于某个值时<br /><img src="../../images/automation/rec.png" / class="rec">
                        </li>
                        <li>
                            <img src="../../images/automation/between.png" /><br />在两值之间时<br /><img src="../../images/automation/rec.png" / class="rec">
                        </li>
                        <li>
                            <img src="../../images/automation/equal.png" /><br />等于某个值时<br /><img src="../../images/automation/rec.png" / class="rec">
                        </li>
                        <li>
                            <img src="../../images/automation/besides.png" /><br />在两值之外时<br /><img src="../../images/automation/rec.png" / class="rec">
                        </li>
                    </ul>
                    <div class="layui-tab-content">
                        <div class="layui-tab-item layui-show">
                            <img src="../../images/automation/higher-p.png" />
                            <br />
                            <div style="margin-left: 33px;">
                                <input value="" class="layui-input" />
                                <p>阈值</p>
                            </div>
                        </div>
                        <div class="layui-tab-item">
                            <img src="../../images/automation/lower-p.png" />
                            <br />
                            <div style="margin-left:34px;">
                                <input value="" class="layui-input" />
                                <p>阈值</p>
                            </div>
                        </div>
                        <div class="layui-tab-item">
                            <img src="../../images/automation/between-p.png" />
                            <br />
                            <div class="">
                                <input value="" class="layui-input" />
                                <p>低阈值</p>
                            </div>
                            <div class="">
                                <input value="" class="layui-input" />
                                <p>高阈值</p>
                            </div>
                        </div>

                        <div class="layui-tab-item">
                            <img src="../../images/automation/equal-p.png" />
                            <br />
                            <div class="">
                                <input value="" class="layui-input" />
                                <p>触发值</p>
                            </div>
                        </div>

                        <div class="layui-tab-item">
                            <img src="../../images/automation/besides-p.png" />
                            <br />
                            <div class="">
                                <input value="" class="layui-input" />
                                <p>低阈值</p>
                            </div>
                            <div class="">
                                <input value="" class="layui-input" />
                                <p>高阈值</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <!----------------------------新建执行操作 start---------------------------->
    <div class="add_operation" id="new_operation">
        <form class="layui-form" action="">
            <label class="layui-form-label datetype">操作类型</label>
            <div class="layui-tab">
                <ul class="layui-tab-title">
                    <li><input type="radio" name="time" value="操作控制设备" title="操作控制设备" checked=""></li>
                    <li><input type="radio" name="time" value="开/关其他自动化" title="开/关其他自动化"></li>
                    <li><input type="radio" name="time" value="延时" title="延时"></li>
                    <!--<li><input type="radio" name="time" value="消息提醒" title="消息提醒"></li>-->
                </ul>
                <div class="layui-tab-content">

                    <!--操作控制设备-->
                    <div class="layui-tab-item layui-show equipment">
                        <div class="layui-inline">
                            <label class="layui-form-label">所属地块</label>
                            <div class="layui-input-inline layui-form" lay-filter="area2">
                                <select name="modules" lay-verify="required" lay-search="" id="area2"
                                        lay-filter='newoperation_device'>
                                    <option value="">直接选择或搜索选择</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-inline pic">
                            <label class="layui-form-label">设备名称</label>
                            <div class="layui-input-inline layui-form" lay-filter="device2">
                                <select name="modules" lay-verify="required" lay-search=""
                                        lay-filter='newoperation_name' id="device2">
                                    <option value="">直接选择或搜索选择</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">设备通道</label>
                            <div class="layui-input-inline layui-form" lay-filter="slot2">
                                <select name="modules" lay-verify="required" lay-search="" id="slot2"
                                        lay-filter='newoperation_slot'>
                                    <option value="">直接选择或搜索选择</option>
                                </select>

                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">设备控制</label>
                            <div class="layui-input-block eq-control layui-form" lay-filter="content1">
                                <select name="" id="content1" lay-filter='newoperation_content1'>
                                    <option value=""></option>
                                </select>
                            </div>
                            <div class="layui-input-block  delay-time">
                                <input id="time1" type="text" name="title" lay-verify="title" autocomplete="off"
                                       placeholder="执行时长" class="layui-input">
                            </div>
                            <span class="hint"></span>
                        </div>
                    </div>

                    <!--开关其他自动化-->
                    <div class="layui-tab-item other">
                        <div class="layui-inline">
                            <label class="layui-form-label">自动化</label>
                            <div class="layui-input-inline layui-form" lay-filter="TargetAutomationID">
                                <select name="modules" lay-verify="required" lay-search="" lay-filter='other_name'
                                        id="TargetAutomationID">
                                    <option value="">直接选择或搜索选择</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">开启/关闭</label>
                            <div class="layui-input-block layui-form" lay-filter="action">
                                <select name="interest" lay-filter="aihao" id="action">
                                    <option value=""></option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!--延时-->
                    <div class="layui-tab-item time" style="top:0;right:0;">
                        <label class="layui-form-label">延时时长</label>
                        <div class="layui-input-block delay-time">
                            <input id="time2" type="text" name="title" lay-verify="title" autocomplete="off"
                                   placeholder="请输入延时时长" class="layui-input" style="font-size:12px">
                        </div>
                    </div>

                    <!--消息提示-->
                    <!--<div class="layui-tab-item">
                        <p>我是消息提示的内容</p>
                    </div>-->
                </div>
            </div>
        </form>
    </div>
    <!----------------------------新建执行操作 end---------------------------->
</div>
<script>
    var state = 1; //设备触发配置 全天/自定义
    var BeginTime = "00:00:00";
    var EndTime = "23:59:59";
    var onOff = true;
    var automationInfo = {
        ID: "",
        Name: "",
        Type: "",
        Status: "",
        CreateTime: "",
        CreateUser: "",
        UpdateTime: "",
        UpdateUser: "",
        DevName: "",
    };
    var ConditionType = "OR";
    var layer, form, laydate, element;

    var DeviceList = []; //当前用户已绑定的设备（不分地块）
    var DeviceList2 = []; //当前用户所有的设备（不分地块）

    var TerminalList = []; //同一终端下的设备(控制设备、传感设备)

    //此处可优化的点很多，完成功能后记得优化；
    var landList = []; //当前用户下所有的地块   、、执行操作中
    var soltList = []; //设备通道列表     、、执行操作中
    var ArealandList = []; //当前用户下所有的地块  、、触发条件中
    var AreaSoltList = []; //当前用户下设备通道列表  、、触发条件中

    var Desc = "";

    var operation = "insert";
    var automationList = [];

    var DescType = true;
    var action = [{
        "action": "ACTIVATE",
        "value": "开启"
    }, {
        "action": "DEACTIVATE",
        "value": "关闭"
    }];
    //添加执行操作与添加设备触发条件中间受Desc控制；拿到地块后获取地块下所有的设备，通过Desc查找所有符合条件的控制器和传感器
    //渲染所处的设备名称下拉列表
    $(function () {
        layui.use(['form', 'layer', 'laydate', 'element'], function () {
            layer = layui.layer;
            form = layui.form;
            laydate = layui.laydate;
            element = layui.element;
            form.render();

            /*立即启用 按钮触发*/
            form.on('switch(switchTest)', function (data) {
                // console.log("<<<<<>>>>>>><")
                // console.log(data);
                // console.log(data.elem.checked);
                onOff = data.elem.checked;
            });
            form.on('radio(ConditionType)', function (data) {
                ConditionType = data.value
            });
            /*有效时间段 全天和自定义切换显示*/
            form.on('radio(time)', function (data) {
                state = data.value;
                if (data.value == 2) {
                    $(".custom_time").removeClass("hidden");
                } else {
                    $(".custom_time").addClass("hidden");
                }
            });
            laydate.render({
                elem: '#time_box',
                type: 'time',
                theme: '#389bff',
                range: true,
                format: 'HH:mm:ss',
                done: function (value, date, endDate) {
                    BeginTime = value.split(' - ')[0];
                    EndTime = value.split(' - ')[1];
                }
            });
            //点击保存，保存编辑或者新建的自动化信息
            $("#submit").click(function () {
                if ($("#Name").val() == "") {
                    layer.msg('请输入自动化名称', {
                        icon: 2,
                        time: 1500
                    });
                } else if ($(".opt_before").is(':visible')) {
                    $(".option .opt_before li").css({
                        "border-color": "#FF5722"
                    });
                    setTimeout(function () {
                        $(".option .opt_before li").css({
                            "border-color": "#c2c2c2"
                        });
                    }, 1000);
                    layer.msg('请添加触发条件', {
                        icon: 2,
                        time: 1500
                    });
                } else if ($(".operate_before li.clearfix").is(':visible')) {
                    $(".operate .operate_before li").css({
                        "border-color": "#FF5722"
                    });
                    setTimeout(function () {
                        $(".operate .operate_before li").css({
                            "border-color": "#c2c2c2"
                        });
                    }, 1000);
                    layer.msg('请添加执行操作', {
                        icon: 2,
                        time: 1500
                    });
                } else {
                    SetAutomation();
                }
            });
        });
        init();
        ieinputolddata();

        //文案说明
        var layertip = null;
        var layuitimer = null;
        $(".equipment .layui-inline span.hint").hover(function () {
            var that = $(this);
            clearTimeout(layuitimer);
            layertip = layer.tips('执行时长表示设备开启的时长和停止工作后的冷却时长', that, {
                tips: [1, '#666']
            })
        }, function () {
            layuitimer = setTimeout(function () {
                layer.close(layertip);
            }, 2000);
        });
    });

    function SetAutomationAction(Action) {
        $("#action").find("option:not(:first)").remove();
        var option = [];
        $.each(action, function (index, item) {
            if (item.action == Action) {
                option.push("<option selected value=\"" + item.action + "\">" + item.value + "</option>");
            } else {
                option.push("<option value=\"" + item.action + "\">" + item.value + "</option>");
            }
        });
        $("#action").append(option.join(""));
        form.render('select', 'action');
    }
    //开/关其他自动化
    //自动化下拉列表
    function SetAutomationSelect(TargetAutomationID) {
        var param = cloneObjectFn(paramList);
        param["pageSize"] = 1000;
        param["pageIndex"] = 1;
        param["id"] = localStorage.getItem("USER_ID")
        var postdata = GetPostData(param, "automation", "getListPage"); //当前地块下的设备列表
        postFnajax(postdata).then(function (res) {
            autoMationListData = '<option value="' + "-1" + '">' + "请直接选择或搜索选择" + '</option>';
            var autoMationList = JSON.parse(res);
            $.each(autoMationList.data, function (index, item) {
                if (TargetAutomationID == item.ID)
                    autoMationListData = autoMationListData + '<option value=' + item.ID +
                        ' selected >' + item.Name + '</option>';
                else
                    autoMationListData = autoMationListData + '<option value=' + item.ID + '>' + item
                        .Name + '</option>';
            })
            $('#TargetAutomationID').html(autoMationListData);
            form.render('select');
        })
    }

    /*----------------------------------------------------   时间触发条件 start  --------------------------------------*/
    //添加时间触发条件
    function addtimetriggerfn(date_1, date_2, time, state) {
        $("#date_1").val("");
        $("#date_2").val("");
        $("#date_3").val("");
        $("#date_4").val("");
        if (state == 0) {
            $("#date_1").val(date_1);
            $("#date_2").val(time);
            $(".add_time .layui-form .layui-tab ul").html(
                "<li><input type=\"radio\" name=\"time\" value=\"0\" title=\"指定日期\" checked=\"\"></li><li> <input type=\"radio\" name=\"time\" value=\"1\" title=\"指定时间段\"></li>"
            )
            $(".add_time .layui-form .layui-tab .layui-tab-content .layui-tab-item").eq(0).addClass("layui-show")
                .siblings().removeClass("layui-show");

        } else {
            $("#date_4").val(time);
            $("#date_3").val(date_2);
            $(".add_time .layui-form .layui-tab ul").html(
                "<li><input type=\"radio\" name=\"time\" value=\"0\" title=\"指定日期\" ></li><li> <input checked=\"\" type=\"radio\" name=\"time\" value=\"1\" title=\"指定时间段\"></li>"
            )
            $(".add_time .layui-form .layui-tab .layui-tab-content .layui-tab-item").eq(1).addClass("layui-show")
                .siblings().removeClass("layui-show");
        }
        form.render('radio');
        layer.open({
            type: 1,
            title: '添加时间条件',
            content: $(".add_time"),
            area: ['520px', '290px'],
            btn: ['确定', '取消'],
            yes: function (index, layero) {
                date_1 = $("#date_1").val();
                date_2 = $("#date_3").val();
                var type = $(".add_time .layui-form .layui-tab .layui-tab-content .layui-tab-item").index($(
                    ".add_time .layui-form .layui-tab .layui-tab-content .layui-show"));
                if (type == 0) {
                    time = $("#date_2").val();
                } else {
                    time = $("#date_4").val();
                }
                var index2 = $(".add_time .layui-form .layui-tab .layui-tab-content .layui-tab-item").index(
                    $(".add_time .layui-form .layui-tab .layui-tab-content .layui-show"));
                if ((index2 == 0 && date_1 == "") || (index2 == 1 && date_2 == "")) {
                    layer.msg('请输入日期', {
                        icon: 2,
                        time: 1000
                    });
                } else if (time == "") {
                    layer.msg('请输入时间', {
                        icon: 2,
                        time: 1000
                    });
                } else {
                    autoMation.addtimeitem(date_1, date_2, time);
                    layer.close(index);
                    DivHide();
                }
            },
            btn2: function (index, layero) {
                DivHide();
            },
            cancel: function () {
                DivHide();
            },
            success: function () {
                //添加时间条件-日期类型 tab
                $(".add_time .layui-form .layui-tab .layui-tab-title li").on('click', function () {
                    $(".add_time .layui-form .layui-tab .layui-tab-content .layui-tab-item").eq($(
                        this).index()).addClass("layui-show").siblings().removeClass(
                            "layui-show");
                })

            }
        });
        laydate.render({
            elem: '#date_1',
            theme: '#389bff',
            change: function (value, date, endDate) {
                date_1 = value;
            },
            done: function (value, date, endDate) {
                date_1 = value;
            }
        });
        laydate.render({
            elem: '#date_2',
            type: 'time',
            theme: '#389bff',
            change: function (value, date, endDate) {
                time = value;
            },
            done: function (value, date, endDate) {
                time = value;
            }
        });
        laydate.render({
            elem: '#date_3',
            range: true,
            theme: '#389bff',
            change: function (value, date, endDate) {
                date_2 = value;
            },
            done: function (value, date, endDate) {
                date_2 = value;
            }
        });
        laydate.render({
            elem: '#date_4',
            type: 'time',
            theme: '#389bff',
            change: function (value, date, endDate) {
                time = value;
            },
            done: function (value, date, endDate) {
                time = value;
            }
        });
    }

    //增加时间条件 列
    function addtimeitem(date_1, date_2, time) {
        var index = 0;
        var value = "";
        if (date_1 == '') {
            value = date_2;
            index = 1;
        } else {
            index = 0;
            value = date_1;
        }
        if (date_1 == "" && date_2 == "") {
            layer.msg('请输入日期', {
                icon: 2,
                time: 1500
            });
        }
        var timertriggerobj = $(
            "<li category='time_trigger' class='clearfix'><div class='left fl time_ico'></div><div class='center fl'>" +
            "<p>" + value + "</p>" +
            "<p>" + time + "</p> " +
            "</div><div class='right fr clearfix'>" +
            "<span class='edit fl' onclick=\"addtimetriggerfn('" + date_1 + "','" + date_2 + "','" + time + "'," +
            index + ")\" title='编辑'></span>" +
            "<span class='del fl' onclick='deletetimefn(id,this)' title='删除'></span></div></li>");
        if ($(".list_wrap .time_after").find("li.clearfix").length == 0)
            $(".list_wrap .time_after").append(timertriggerobj);
        else
            $('.time_after li').eq(0).html(timertriggerobj.html());
        $(".option .opt_before").hide();
    }
    /*--------------------------------------------------   时间触发条件 end  --------------------------------------*/

    /*--------------------------------------------------   添加设备触发条件 start------------------------------------*/
    function addequiptriggerfn(obj, AreaID, DeviceID, SlotID, EnableHigh, HighValue, EnableLow, LowValue, data) {
        DescType = DeviceID == "" ? true : false;
        var title = "";
        if (AreaID == '') {
            title = '添加设备触发条件';
            $(".equipment-content2").find("input").val('');
        } else {
            title = '修改设备触发条件';
        };
        //选择地块获取设备
        form.on('select(lay_area)', function (data) {
            AreaID = data.value;
            var LandDevice = []; //地块中的设备
            var param = cloneObjectFn(paramList);
            param["landId"] = AreaID;
            var postdata = GetPostData(param, "land", "getDeviceList"); //所有设备
            postFnajax(postdata).then(function (res) {
                var result = JSON.parse(res);
                $.each(result.data, function (index, item) {
                    if (item.DeviceCategory != "INTEGRATED") {
                        LandDevice.push(item);
                    }
                });
                $.each(LandDevice, function (index, item) {
                    $.each(DeviceList2, function (index2, itme2) {
                        if (item.DeviceDesc == itme2.DeviceDesc) {
                            TerminalList.push(itme2);
                        }
                    })
                })
                SetDeviceSelect(TerminalList);
            });


        });
        //选择设备名称
        form.on('select(equipment_name)', function (data) {
            if (data.value == "1") {
                layer.msg('请选择设备名称', {
                    time: 2000
                });
                return false;
            } else {
                // console.log(data.value)
                SetSlotSelect(data.value);
                DeviceID = data.value;
            }
        });
        //选择通道
        form.on('select(slot)', function (data) {
            // console.log(data);
            SlotSensorType = data.value.split(",");
            SlotID = SlotSensorType[0];
        })
        //弹出选择时间条件 弹框
        var layuiobj = layer.open({
            type: 1,
            title: title,
            content: $(".add_equipment"),
            area: '552px',
            btn: ['确定', '取消'],
            yes: function (index, layero) {
                // 验证选择框是否为空
                if (AreaID == "") {
                    layer.msg('请选择区域', {
                        icon: 2,
                        time: 1500
                    });
                } else if (DeviceID == "") {
                    layer.msg('请选择设备', {
                        icon: 2,
                        time: 1500
                    });
                } else if (SlotID == "") {
                    layer.msg('请选择设备通道', {
                        icon: 2,
                        time: 1500
                    });
                } else {
                    data = $(".button").find("button").index($(".button .selected"));
                    // console.log(data); //数字0
                    var obj1 = $(".equipment-content2 .layui-tab-item").index($(
                        ".equipment-content2 .layui-show"));
                    // console.log(obj1); //数字0
                    var value1 = $(".equipment-content2 .layui-show").find("input").eq(0).val();
                    // console.log("<<<<<>>>>>")
                    // console.log(value1); //空
                    var value2 = $(".equipment-content2 .layui-show").find("input").eq(1).val();
                    // console.log(value2); //undefined
                    if ($('.equipment-content1').css('display') == "none") {
                        var re = /^\d+(?=\.{0,1}\d+$|$)/;
                        //var re = /^-?[1-9]*(.d*)?$|^-?0(.d*)?$/;
                        if (obj1 == 0 && !(!!value1 && !isNaN(value1))) {
                            layer.msg('请输入正确触发条件范围', {
                                icon: 2,
                                time: 1500
                            });
                        } else if (obj1 == 1 && !(!!value1 && !isNaN(value1))) {
                            layer.msg('请输入正确触发条件范围', {
                                icon: 2,
                                time: 1500
                            });
                        } else if (obj1 == 2 && (!(!!value2 && !isNaN(value2)) || !(!!value1 && !isNaN(
                            value1)) || value2 * 1 <= value1 * 1)) {
                            layer.msg('请输入正确触发条件范围', {
                                icon: 2,
                                time: 1500
                            });
                        } else if (obj1 == 3 && !(!!value1 && !isNaN(value1))) {
                            layer.msg('请输入正确触发条件范围', {
                                icon: 2,
                                time: 1500
                            });
                        } else if (obj1 == 4 && (!(!!value2 && !isNaN(value2)) || !(!!value1 && !isNaN(
                            value1)) || value2 * 1 <= value1 * 1)) {
                            layer.msg('请输入正确触发条件范围', {
                                icon: 2,
                                time: 1500
                            });
                        } else {
                            addequipitem(obj, AreaID, DeviceID, SlotID, data);
                            layer.close(index);
                            DivHide();
                        }
                    } else {
                        addequipitem(obj, AreaID, DeviceID, SlotID, data);
                        layer.close(index);
                        DivHide();
                    }
                }
            },
            btn2: function (index, layero) {
                DivHide();
            },
            cancel: function () {
                DivHide();
            }
        });
        //初始化区域
        SetAreaSelect(AreaID);
        //初始化设备名称列表
        SetDeviceSelect(DeviceList);
        //温度传感器-设置触发条件 tab切换
        $('.add_equipment .equipment-content2 .layui-tab-title li').on('click', function () {
            $(this).addClass('layui-this selected').siblings().removeClass('layui-this selected');
            $(".add_equipment .equipment-content2 .layui-tab-content .layui-tab-item").eq($(this).index())
                .addClass("layui-show").siblings().removeClass("layui-show");
        })

        //选择设备下面的对应的风机内容
        $('.add_equipment .equipment-content1 .button button').on('click', function () {
            $(this).addClass('selected').siblings().removeClass('selected');
        })
        //设备触发条件的tab切换；
        $('.add_equipment .equipment-content2 ul li').on('click', function () {
            $(this).siblings().find('.rec').css('display', 'none');
            $(this).find('.rec').css({
                'display': 'block',
                'border': 'none'
            });
        })
    }

    //区域下拉列表
    function SetAreaSelect(AreaID) {
        var areaOption = [];
        var param = cloneObjectFn(paramList);
        var postdata = GetPostData(param, "land", "getLandListPage");
        postFnajax(postdata).then(function (res) {
            var result = JSON.parse(res);
            ArealandList = result;
            $.each(result.data, function (index, item) {
                areaOption.push("<option value=\"" + item.LandID + "\">" + item.LandName + "</option>");
            })
            $("#area").append(areaOption.join());
            form.render('select', 'test1');
        })
    };

    //设备下拉列表
    function SetDeviceSelect(devicelist) { //landID, DeviceID, layuiobj
        $("#device").find("option:not(:first)").remove();
        var deverce = [];
        var deverceOption = [];
        $.each(devicelist, function (index, item) {
            if (item.DeviceCategory != "INTEGRATED") {
                deverce.push(item)
            }
        })
        $.each(deverce, function (index, item) {
            // console.log(deverce);
            deverceOption.push("<option value=\"" + item.DeviceID, item.DeviceTypeID, item.DeviceCategory +
                "\">" + item.DeviceName + "</option>");
        })
        $("#device").append(deverceOption.join());
        form.render('select', 'test2');
    };

    //设备通道下拉列表
    function SetSlotSelect(deviceType) {
        var devicedata = deviceType.split(",");
        var param = cloneObjectFn(paramList);
        param["deviceType"] = devicedata[1];
        var postdata = GetPostData(param, "device", "getSlotTemplateList");
        postFnajax(postdata).then(function (res) {
            $("#slot").find("option:not(:first)").remove();
            var result = JSON.parse(res);
            AreaSoltList = result;
            var typeIDOption = [];
            $.each(result.data, function (index, item) {
                typeIDOption.push("<option value=\"" + item.Slot, item.SensorType + "\">" + item
                    .SensorName + " - " + item.SlotName + "</option>")
            })
            $("#slot").append(typeIDOption.join());
            form.render('select', 'slot');
            if (devicedata[2] == 'CONTROLLER') {
                $('.equipment-content1').css('display', 'block');
                $('.equipment-content2').css('display', 'none');
                layerH = ($(window).height() - 468) / 2;
                if (DeviceTypeID == 13) {
                    $(".button").find("button").eq(2).show();
                } else if (DeviceTypeID == 14) {
                    $(".button").find("button").eq(2).hide();
                }
                $(".button").find("button").removeClass("selected");
                $(".button").find("button").eq(data).addClass("selected");
            } else if (devicedata[2] == 'SENSOR') {
                $('.equipment-content1').css('display', 'none');
                $('.equipment-content2').css('display', 'block');
                layerH = ($(window).height() - 603) / 2;
                SetSection(EnableHigh, HighValue, EnableLow, LowValue);
            } else {
                $('.equipment-content1').css('display', 'none');
                $('.equipment-content2').css('display', 'none');
                layerH = ($(window).height() - 357) / 2;
            }
        })
    }


    /*--------------------------------------------------   添加设备触发条件 end ------------------------------------*/

    /*--------------------------------------------------   执行操作 start  ----------------------------------------*/
    function createOperate(obj, AreaID, DeviceID, SlotID, device_data, state, time, TargetAutomationID, Action, Delay) {
        $("#time1").val("");
        $("#time2").val('');
        var title = "";
        if (AreaID == '') {
            title = '添加执行操作';
            $(".equipment-content2").find("input").val('');
        } else {
            title = '修改执行操作';
        }
        //选择地块渲染设备下拉列表，获取AreaID
        form.on('select(newoperation_device)', function (data) {
            AreaID = data.value;
            DeviceID = "";
            SlotID = '';
            device_data = '';
            SetDeviceSelect2(data.value, null);
            $("#slot2").find("option:not(:first)").remove();
            form.render('select', 'slot2');
            $("#content1").find("option:not(:first)").remove();
            form.render('select', 'content1');
        });
        //选择设备渲染通道下拉列表，获取DeviceID
        form.on('select(newoperation_name)', function (data) {
            DeviceID = data.value;
            SlotID = '';
            device_data = '';
            SetSlotSelect2(data.value, null, '');
        })
        //选择通道SlotID
        form.on('select(newoperation_slot)', function (data) {
            SlotID = data.value;
        });
        //设备控制
        form.on('select(newoperation_content1)', function (data) {
            device_data = data.value;
        });
        //弹出选择时间条件 弹框
        layer.open({
            type: 1,
            title: title,
            content: $("#new_operation"),
            area: ['620px', '390px'],
            btn: ['确定', '取消'],
            yes: function (index, layero) {
                var time = $(".add_operation .layui-tab .layui-tab-content .layui-show").find("input:last")
                    .val();
                var state = $(".add_operation .layui-tab .layui-tab-content .layui-tab-item").index($(
                    ".add_operation .layui-tab .layui-tab-content .layui-show"));
                var reg = /^[1-9]\d*$/;
                switch (state) {
                    case 0:
                        if (AreaID == "") {
                            layer.msg('请选择区域', {
                                icon: 2,
                                time: 1500
                            });
                            return false;
                        } else if (DeviceID == "") {
                            layer.msg('请选择设备', {
                                icon: 2,
                                time: 1500
                            });
                            return false;
                        } else if (SlotID == "") {
                            layer.msg('请选择设备通道', {
                                icon: 2,
                                time: 1500
                            });
                            return false;
                        } else if (device_data == "") {
                            layer.msg('请选择设备控制', {
                                icon: 2,
                                time: 1500
                            });
                            return false;
                        } else if (!reg.test($("#time1").val())) {
                            layer.msg('请输入执行时长', {
                                icon: 2,
                                time: 1500
                            });
                            return false;
                        }
                        break;
                    case 1:
                        if (TargetAutomationID == "") {
                            layer.msg('请选择自动化', {
                                icon: 2,
                                time: 1500
                            });
                            return false;
                        } else if (Action == "") {
                            layer.msg('请选择开启/关闭', {
                                icon: 2,
                                time: 1500
                            });
                            return false;
                        }
                        break;
                    case 2:
                        if (!reg.test($("#time2").val())) {
                            layer.msg('请输入延时时长', {
                                icon: 2,
                                time: 1500
                            });
                            return false;
                        }
                        break;
                }
                addoperateitem(obj, AreaID, DeviceID, SlotID, device_data, time, TargetAutomationID,
                    Action);
                layer.close(index);
                DivHide();
            },
            btn2: function (index, layero) {
                DivHide();
            },
            cancel: function () {
                DivHide();
            }
        });
        var temp = $("<li><input type=\"radio\" name=\"time\" value=\"操作控制设备\" title=\"操作控制设备\"></li>" +
            "<li><input type=\"radio\" name=\"time\" value=\"开 / 关其他自动化\" title=\"开 / 关其他自动化\"></li>" +
            "<li><input type=\"radio\" name=\"time\" value=\"延时\" title=\"延时\"></li>");
        temp.find("input").eq(state).attr("checked", "checked");
        $(".add_operation .layui-form .layui-tab ul").html(temp)
        $(".add_operation .layui-tab .layui-tab-content .layui-tab-item").eq(state).addClass("layui-show").siblings()
            .removeClass("layui-show");
        form.render('radio');
        if (state == 0)
            $("#time1").val(time);
        else
            $("#time2").val(Delay);
        //初始化地块
        SetAreaSelect2(AreaID);
        //初始化设备
        SetDeviceSelect2(AreaID, DeviceID);
        //初始化插槽
        SetSlotSelect2(DeviceID, SlotID, device_data);
        //初始化自动化
        SetAutomationSelect(TargetAutomationID);
        //自动化Action
        SetAutomationAction(Action);
        //操作类型 tab 切换
        $(".add_operation .layui-tab-title li").on('click', function () {
            $(".add_operation .layui-tab .layui-tab-content .layui-tab-item").eq($(this).index()).addClass(
                "layui-show").siblings().removeClass("layui-show");
        })
        form.on('select(other_name)', function (data) {
            TargetAutomationID = data.value;
        })
        form.on('select(aihao)', function (data) {
            Action = data.value;
        })
    };

    //执行操作 //区域下拉列表
    function SetAreaSelect2(LandID) {
        var option = [];
        option.push("<option value=\"\">直接选择或搜索选择</option>");
        $.each(autoMation.DeviceList, function (index, item) {
            var count = 0;
            $.each(item.Devices, function (index2, item2) {
                if (automationInfo.DevName == "" || automationInfo.DevName == item2.Number) {
                    count++;
                }
            })
            if (count == item.Devices.length) {
                if (item.LandID == LandID) {
                    option.push("<option value=\"" + item.LandID + "\" selected>" + item.LandName +
                        "</option>");
                } else {
                    option.push("<option value=\"" + item.LandID + "\">" + item.LandName + "</option>");
                }
            }
        });
        $("#area2").find("option").remove();
        $("#area2").append(option.join());
        form.render('select', 'area2');
    };

    //设备下拉列表
    function SetDeviceSelect2(LandID, DeviceID) {
        var option = [];
        option.push("<option value=\"\">直接选择或搜索选择</option>");
        $.each(autoMation.DeviceList, function (index, item) {
            if (item.LandID == LandID) {
                $.each(item.Devices, function (index2, item2) {
                    if (item2.Category == "CONTROLLER") {
                        if (automationInfo.DevName == "" || automationInfo.DevName == item2.Number) {
                            if (item2.DeviceID == DeviceID) {
                                option.push("<option value=\"" + item2.DeviceID + "\" selected>" + item2
                                    .DeviceName + "</option>");
                            } else {
                                option.push("<option value=\"" + item2.DeviceID + "\">" + item2
                                    .DeviceName + "</option>");
                            }
                        }
                    }

                });
            }
        });
        $("#device2").find("option").remove();
        $("#device2").append(option.join());
        form.render('select', 'device2');
    };

    // 设备通道下拉列表
    function SetSlotSelect2(DeviceID, SlotID, data) {
        var DeviceTypeID = 0;
        $("#slot2").find("option:not(:first)").remove();
        var option = [];
        $.each(autoMation.DeviceList, function (index, item) {
            $.each(item.Devices, function (index2, item2) {
                if (item2.DeviceID == DeviceID) {
                    DeviceTypeID = item2.DeviceType;
                    $.each(item2.Slots, function (index3, item3) {
                        if (item3.Slot == SlotID) {
                            option.push("<option value=\"" + item3.Slot + "\" selected>" + item3
                                .SensorName + "</option>");
                        } else {
                            option.push("<option value=\"" + item3.Slot + "\">" + item3
                                .SensorName + "</option>");
                        }
                    });
                }
            });
        });
        $("#slot2").append(option.join(""));
        form.render('select', 'slot2');
        $("#content1").find("option:not(:first)").remove();
        var temp = $("<select>" +
            "<option value=\"\">请选择</option>" +
            "<option value=\"0\">开</option>" +
            "<option value=\"1\">关</option>" +
            "</select>"
        );
        if (DeviceTypeID == 13 || DeviceTypeID == 4001) { //开关停
            temp.append("<option value=\"2\">停</option>");
        }

        if (data == "") { } else {
            temp.find("option").eq(data * 1 + 1).attr("selected", 'selected');
        }
        $("#content1").html(temp.html());
        form.render('select', 'content1');

    };

    //添加执行操作添加执行操作 列
    function addoperateitem(obj, AreaID, DeviceID, SlotID, data, time, TargetAutomationID, Action) {
        var sort = $('.operate_after li').index($(obj).closest("li"));
        var state = $(".add_operation .layui-tab .layui-tab-content .layui-tab-item").index($(
            ".add_operation .layui-tab .layui-tab-content .layui-show"));
        var DeviceTypeName = "";
        var SlotName = "";
        var Area = "";
        var Condition = "";
        var Img = "";
        var DeviceCategory = "";
        var DeviceTypeID;
        var DeviceName;
        var type = "";
        var equiptriggerobj;
        if (state == 0) {
            $.each(autoMation.DeviceList, function (index, item) {
                if (item.LandID == AreaID) {
                    Area = item.LandName;
                    $.each(item.Devices, function (index2, item2) {
                        if (item2.DeviceID == DeviceID) {
                            DeviceCategory = item2.Category;
                            DeviceName = item2.DeviceName;
                            automationInfo.DevName = item2.Number;
                            $.each(item2.Slots, function (index3, item3) {
                                if (item3.Slot == SlotID) {
                                    SlotName = item3.SensorName;
                                }
                            })
                        }
                    });
                }
            });
            if (DeviceCategory == 'CONTROLLER') {
                type = "device_execution";
                Condition = $("#content1").find('option').eq(data * 1 + 1).text();
                equiptriggerobj = $("<li class='clearfix' category='device_execution'>" +
                    "<div class='left fl temper_ico'></div>" +
                    "<div class='center fl'>" +
                    "<p><span>" + Condition + "</span>" +
                    '<span>执行时长：' + time + '分钟</span></p>' +
                    "<p><span>" + DeviceName + "</span>" +
                    "<span>" + SlotName + "</span>" +
                    "<span>" + Area + "</span></p></div>" +
                    '<div class="right fr clearfix">' +
                    '<span class="up fl" title="上移"></span>' +
                    '<span class="down fl" title="下移"></span>' +
                    "<span class=\"edit fl\" onclick=\"createOperate(this,'" + AreaID + "','" + DeviceID + "'," +
                    SlotID + ",'" + data + "'," + state + ",'" + time + "','','','')\" title=\"编辑\"></span>" +
                    '<span class="del fl" onclick="deleteoperateite(id,this)" title="删除"></span>' +
                    '</div>' +
                    '<div class="rank pa">1</div>' +
                    '</li>');
            }
        } else if (state == 1) {
            type = "automation_execution";
            equiptriggerobj = $('<li class="clearfix" category="automation_execution">' +
                '<div class="left fl air_ico"></div>' +
                '<div class="center fl">' +
                '<p>' +
                '<span>' + $("#action option[value='" + Action + "']").text() + '自动化</span>' +
                '<span></span>' +
                '</p><p><span>' + $("#TargetAutomationID option[value='" + TargetAutomationID + "']").text() +
                '</span>' +
                '<span></span>' +
                '<span></span></p>' +
                '</div>' +
                '<div class="right fr clearfix">' +
                '<span class="up fl" title="上移"></span>' +
                '<span class="down fl" title="下移"></span>' +
                "<span class=\"edit fl\" onclick=\"createOperate(this,'','','',''," + state + ",'','" +
                TargetAutomationID + "','" + Action + "','')\" title=\"编辑\"></span>" +
                '<span class="del fl" onclick="deleteoperateite(id,this)" title="删除"></span>' +
                '</div>' +
                '<div class="rank pa">1</div>' +
                '</li>');
        } else {
            type = "delay_execution";
            equiptriggerobj = $('<li class="clearfix" category="delay_execution">' +
                '<div class="left fl air_ico"></div>' +
                '<div class="center fl">' +
                '<p>' +
                '<span></span>' +
                '<span></span>' +
                '</p><p><span>延时' + $("#time2").val() + '分钟</span>' +
                '<span></span>' +
                '<span></span></p>' +
                '</div>' +
                '<div class="right fr clearfix">' +
                '<span class="up fl" title="上移"></span>' +
                '<span class="down fl" title="下移"></span>' +
                "<span class=\"edit fl\" onclick=\"createOperate(this,'','','',''," + state + ",'','','','" + $(
                    "#time2").val() + "')\" title=\"编辑\"></span>" +
                '<span class="del fl" onclick="deleteoperateite(id,this)" title="删除"></span>' +
                '</div>' +
                '<div class="rank pa">1</div>' +
                '</li>');
        }


        if ($(".operate .operate_after li").length == 0) {
            $(".operate .continue").show();
        }
        $(".operate_before li").addClass("hidden");
        $(".operate .continue").removeClass("hidden");
        if (sort == -1)
            $(".operate_after").append(equiptriggerobj);
        else {
            $('.operate_after li').eq(sort).html(equiptriggerobj.html());
            // alert(type);
            $('.operate_after li').eq(sort).attr("category", type);
        }
        init(); //初始化 右边箭头
    };

    $(".operate_after").delegate('.down,.up', 'click', function () {
        upDown($(this).get(0));
    });

    /*执行操作 上下箭头显示刷新 */
    function init() {
        var len = $(".operate_after li").length;
        if (len == 1) {
            $(".operate_after li").find(".right .down").addClass('disable');
            $(".operate_after li").find(".right .up").addClass('disable');
            $(".operate_after li").eq(0).find(".rank").text(1);
        } else {

            $(".operate_after li").eq(0).find(".right").show();
            $(".operate_after li").eq(0).find(".up").addClass("disable");
            $(".operate_after li").eq(0).siblings("li").find(".up").removeClass("disable");
            $(".operate_after li").eq(len - 1).find(".down").addClass("disable");
            $(".operate_after li").eq(len - 1).siblings("li").find(".down").removeClass("disable");
            for (var i = 0; i < len; i++) {
                $(".operate_after li").eq(i).find(".rank").text(i + 1);
            }
        }
    };

    /*执行操作 dom节点 顺序剪切操作 */
    function upDown(obj) {
        if (!$(obj).hasClass("disable")) {
            if ($(obj).hasClass("up")) {
                var parent = $(obj).closest("li");
                var parentPrev = parent.prev("li");
                parentPrev.before(parent);
            } else {
                var parent = $(obj).closest("li");
                var parentNext = parent.next("li");
                parent.before(parentNext);
            }
            init();
        }
    };

    //删除执行操作列
    function deleteoperateite(id, obj) {
        layer.confirm('您确定删除该执行操作吗？', {
            title: '温馨提示'
        }, function (index) {
            if ($(obj).closest('.operate_after').find('li.clearfix').length > 1) {
                $(obj).closest('li.clearfix').remove();
            } else {
                $(obj).closest('li.clearfix').remove();
                $(".operate .continue").hide();
                $(".operate .operate_before li").removeClass("hidden");
            }
            init();
            layer.close(index);
        });
    };

    /*--------------------------------------------------  执行操作  end   -----------------------------------------*/
    //获取当前用户下已经绑定的设备
    function GetAutomation() {
        //landid 可选参数
        // status:0 没有分配过地块的设备
        // status:1 分配过地块的设备
        // status : null 拿所有设备
        var param = cloneObjectFn(paramList);
        param["status"] = "1";
        var postdata = GetPostData(param, "land", "getDeviceList"); //所有设备
        postFnajax(postdata).then(function (res) {
            var result = JSON.parse(res);
            DeviceList = result.data;
        })
    };
    //获取当前用户下所有的设备
    function GetAutomation2() {
        var param = cloneObjectFn(paramList);
        param["status"] = "";
        var postdata = GetPostData(param, "land", "getDeviceList"); //所有设备
        postFnajax(postdata).then(function (res) {
            var result = JSON.parse(res);
            DeviceList2 = result.data;
        })
    };

    //ie下 input禁止记录历史输入
    function ieinputolddata() {
        setTimeout(function () {
            $("input").attr("autocomplete", "off");
        }, 1000)
    }

    //隐藏三大列
    function DivHide() {
        $(".add_time").hide();
        $(".add_equipment").hide();
        $("#new_operation").hide();
    }

    //点击保存新增一条自动化
    function SetAutomation() {
        var time_trigger = []; //时间触发条件字段数据
        var device_trigger = []; //设备触发条件字段数据
        var delay_execution = []; //延时执行操作字段数据
        var automation_execution = []; //
        var device_execution = []; //执行操作操作控制设备字段数据
        var Automationid = autoMation.id;
        $.each(autoMation.TriggerList, function (index, item) {
            if (item.Category == "Time") {
                var BeginDate = ""; //开始时间
                var EndDate = ''; //结束时间
                if (item.value1 == "") {
                    BeginDate = item.value2.split(' - ')[0];
                    EndDate = item.value2.split(' - ')[1];
                } else {
                    BeginDate = item.value1;
                    EndDate = item.value1;
                }
                time_trigger.push({
                    ID: guid(),
                    AutomationID: Automationid,
                    BeginDate: BeginDate,
                    EndDate: EndDate,
                    Time: item.time
                });
            } else if (item.Category == "CONTROLLER") {
                device_trigger.push({
                    ID: guid(),
                    AutomationID: Automationid,
                    Index: index,
                    DeviceID: item.DeviceID,
                    RelayStatus: item.Data
                });
            } else {
                device_trigger.push({
                    ID: guid(),
                    AutomationID: Automationid,
                    Index: index,
                    DeviceID: item.DeviceID,
                    EnableHigh: item.EnableHigh,
                    EnableLow: item.EnableLow,
                    HighValue: item.HighValue,
                    LowValue: item.LowValue
                });
            }
        })

        //获取添加设备触发条件的数据
        //$(".factor_after li").each(function (index, item) {
        //    var value = $(this).find(".clearfix span").eq(0).attr("onclick").replace(/addequiptriggerfn/g, "").replace('\(', '').replace('\)', '').replace(/'/g, "").split(',');
        //    var DeviceID, DeviceName, DeviceLegendID, DeviceTypeID, DeviceSlotID, RelayStatus, EnableHigh, HighValue, EnableLow, LowValue;
        //    DeviceLegendID = guid();
        //    // console.log("1111111");
        //    // console.log(value);
        //    $.each(DeviceList, function (index2, item2) {
        //        if (item2.DeviceID == value[2]) {
        //            DeviceID = item2.DeviceID;
        //            automationInfo.DevName = item2.DeviceName;
        //            DeviceTypeID = item2.DeviceTypeID;
        //            DeviceName = item2.DeviceName;
        //            DeviceSlotID = value[5];
        //            return false;
        //        }
        //    });
        //    var category = $(this).attr("category");
        //    switch (category) {
        //        case "CONTROLLER":
        //            // DeviceSlotID = value[3];
        //            // RelayStatus = value[8];
        //            device_trigger.push({
        //                ID: guid(),
        //                AutomationID: Automationid,
        //                Index: index,
        //                DeviceID: DeviceID,
        //                DeviceName: DeviceName,
        //                DeviceLegendID: DeviceLegendID,
        //                DeviceTypeID: DeviceTypeID,
        //                DeviceSlotID: DeviceSlotID,
        //                RelayStatus: RelayStatus
        //            });
        //            break;
        //        case "SENSOR":
        //            console.log(">>>>>>>>>>");

        //            DeviceSlotID = value[5];

        //            EnableHigh = value[6] == "true" ? true : flase;
        //            HighValue = value[7];
        //            EnableLow = value[8] == "true" ? true : flase;
        //            LowValue = value[9];
        //            RelayStatus = value[10];
        //            device_trigger.push({
        //                ID: guid(),
        //                AutomationID: Automationid,
        //                Index: index,
        //                DeviceID: DeviceID,
        //                DeviceName: DeviceName,
        //                DeviceLegendID: DeviceLegendID,
        //                DeviceTypeID: DeviceTypeID,
        //                DeviceSlotID: DeviceSlotID,
        //                EnableHigh: EnableHigh,
        //                HighValue: HighValue,
        //                EnableLow: EnableLow,
        //                LowValue: LowValue,
        //            });
        //            break;
        //    }
        //})
        //获取添加执行操作的数据
        $(".operate_after li").each(function (index, item) {
            var value = $(this).find(".clearfix span").eq(2).attr("onclick").replace(/createOperate/g, "")
                .replace('\(', '').replace('\)', '').replace(/'/g, "").split(',');
            var category = $(this).attr("category");
            switch (category) {
                case "delay_execution":
                    delay_execution.push({
                        ID: guid(),
                        AutomationID: Automationid,
                        Index: index,
                        Delay: value[9]
                    });
                    break;
                case "automation_execution":
                    var TargetAutomationName = $(this).find(".center span").eq(2).text();
                    automation_execution.push({
                        ID: guid(),
                        AutomationID: Automationid,
                        Index: index,
                        TargetAutomationID: value[7],
                        TargetAutomationName: TargetAutomationName,
                        Action: value[8]
                    });
                    break;
                case "device_execution":
                    var Action = "";
                    if (value[4] == "0")
                        Action = "Open";
                    if (value[4] == "1")
                        Action = "Close";
                    if (value[4] == "2")
                        Action = "Stop";
                    device_execution.push({
                        AutomationID: Automationid,
                        Index: index,
                        DeviceID: value[2],
                        Action: Action,
                        ActionDuration: value[6]
                    });
            }
        })
        automationInfo.ID = Automationid;
        automationInfo.Name = $("#Name").val();
        if (device_trigger.length > 0)
            automationInfo.Type = "Device";
        if (time_trigger.length > 0)
            automationInfo.Type = "Time";
        if (onOff) {
            automationInfo.Status = "ACTIVATED";
        }
        else {
            automationInfo.Status = "DEACTIVATED";
        }

        //设备触发配置表
        var BeginTime, EndTime;
        if (state == 1) {
            BeginTime = "00:00:00";
            EndTime = "23:59:59";
        } else {
            var value = $("#time_box").val();
            if (value == "") {
                layer.msg('请选择有效时间段', {
                    icon: 2,
                    time: 1500
                });
                return false;
            } else {
                BeginTime = value.split(' - ')[0];
                EndTime = value.split(' - ')[1];
            }
        }
        var DeviceTriggerCondition = {
            ID: guid(),
            AutomationID: Automationid,
            ConditionType: ConditionType,
            BeginTime: BeginTime,
            EndTime: EndTime
        };
        if (device_trigger.length == 0)
            DeviceTriggerCondition = null;

        var automation = {
            Automation: automationInfo,
            DeviceTrigger: device_trigger,
            TimeTrigger: time_trigger,
            DeviceTriggerCondition: DeviceTriggerCondition,
            DeviceExecution: device_execution,
            AutomationExecution: automation_execution,
            DelayExecution: delay_execution,
        };
        //autoMation.DeviceList
        //DeviceExecution,DeviceTrigger DeviceID
        // console.log(automation);
        var param = cloneObjectFn(paramList);
        param["entity"] = getUTF8(automation);
        var postdata = GetPostData(param, "automation", operation);
        AjaxRequest(param, "automation", operation).then(function (res) {
            var result = JSON.parse(res);
            // console.log(result);
            if (result.result.code == 200) {
                layer.msg('操作成功', {
                    icon: 1,
                    time: 2000
                }, function () {
                    autoMation.pageSize = 1;
                    autoMation.getListPage();
                    // location.reload();
                    LoadAction('automaticMonitor', 0);
                });
            } else {
                layer.msg(result.result.msg, {
                    icon: 2,
                    time: 2000
                });
            }
        });
    };

    //点击编辑自动化
    //获取自动化明细
    function GetAutomationInfo(AutomationID) {
        var automation = [];
        var param = cloneObjectFn(paramList);
        param["id"] = AutomationID;
        var postdata = GetPostData(param, "automation", "getAutomationInfo");
        postFnajax(postdata).then(function (res) {
            // console.log(res);
            var result = JSON.parse(res);
            automation.push(result.data);
            CreateTable(automation);
        })
    };

    // var time_trigger = [];      //时间触发条件字段数据
    // var device_trigger = [];    //设备触发条件字段数据
    // var delay_execution = [];   //延时执行操作字段数据
    // var automation_execution = []; //
    // var device_execution = [];      //执行操作操作控制设备字段数据

    //自动化编辑页
    function CreateTable(data) {
        if (data.length > 0) {
            $.each(data, function (index, item) {
                var automation_execution = [];
                var Automation = item.Automation;
                var CreateTime = getdate(Automation.CreateTime).format("yyyy/MM/dd hh:mm:ss");
                var UpdateTime = getdate(Automation.UpdateTime).format("yyyy/MM/dd hh:mm:ss");
                automationInfo = Automation;
                automationInfo.CreateTime = CreateTime;
                automationInfo.UpdateTime = UpdateTime;
                $("#Name").val(Automation.Name);
                if (Automation.Status == "DEACTIVATED") {
                    onOff = false;
                    $("#onOff").html(
                        "<input type=\"checkbox\" name=\"onOff\" lay-filter=\"switchTest\" lay-skin=\"switch\" lay-text=\"开启|关闭\">"
                    );
                    form.render();
                }
                //编辑后的时间触发条件
                $.each(item.TimeTrigger, function (index2, TimeTrigger) {
                    var temp
                    if (TimeTrigger.BeginDate == TimeTrigger.EndDate) {
                        autoMation.addtimeitem(TimeTrigger.BeginDate, '', TimeTrigger.Time);
                    } else {
                        autoMation.addtimeitem('', TimeTrigger.BeginDate + " - " + TimeTrigger.EndDate,
                            TimeTrigger.Time);
                        //temp = { "Category": "Time", "value1": date_1, "value2": date_2, "type": index, "time": time };
                    }
                    //autoMation.TriggerList.push(temp);
                }) //pass
                $.each(item.DelayExecution, function (index3, DelayExecution) {
                    // console.log(DelayExecution)
                    var value = '<li class="clearfix" category="delay_execution">' +
                        '<div class="left fl air_ico"></div>' +
                        '<div class="center fl">' +
                        '<p>' +
                        '<span></span>' +
                        '<span></span>' +
                        '</p><p><span>延时' + DelayExecution.Delay + '分钟</span>' +
                        '<span></span>' +
                        '<span></span></p>' +
                        '</div>' +
                        '<div class="right fr clearfix">' +
                        '<span class="up fl" title="上移"></span>' +
                        '<span class="down fl" title="下移"></span>' +
                        "<span class=\"edit fl\" onclick=\"createOperate(this,'','','','',2,'','','','" +
                        DelayExecution.Delay + "')\" title=\"编辑\"></span>" +
                        '<span class="del fl" onclick="deleteoperateite(id,this)" title="删除"></span>' +
                        '</div>' +
                        '<div class="rank pa">1</div>' +
                        '</li>';
                    automation_execution.push({
                        value: value,
                        index: DelayExecution.Index
                    });
                }) //pass
                $.each(item.DeviceExecution, function (index4, DeviceExecution) {
                    var Condition = "";
                    var time = DeviceExecution.ActionDuration;
                    var DeviceName = "";
                    var SlotName = "";
                    var data = 0;
                    var LandID = "";
                    var LandName = "";
                    if (DeviceExecution.Action == "CLOSE") {
                        data = 1;
                        Condition = "关";
                    }
                    if (DeviceExecution.Action == "OPEN") {
                        data = 0;
                        Condition = "开";
                    }
                    if (DeviceExecution.Action == "STOP") {
                        data = 2;
                        Condition = "停";
                    }
                    $.each(autoMation.DeviceList, function (index, item) {
                        $.each(item.Devices, function (index2, item2) {
                            if (item2.DeviceID == DeviceExecution.DeviceID) {
                                DeviceName = item2.DeviceName;
                                LandName = item.LandName;
                                LandID = item.LandID;
                                $.each(item2.Slots, function (index3, item3) {
                                    if (item3.Slot == DeviceExecution
                                        .DeviceSlotID) {
                                        SlotName = item3.SensorName;
                                    }
                                })
                            }
                        })
                    });

                    var value = "<li class='clearfix' category='device_execution'>" +
                        "<div class='left fl temper_ico' style='background:url(\"../../images/automation/\")no-repeat center'></div>" +
                        "<div class='center fl'>" +
                        "<p><span>" + Condition + "</span>" +
                        '<span>执行时长：' + time + '分钟</span></p>' +
                        "<p><span>" + DeviceName + "</span>" +
                        "<span>" + SlotName + "</span>" +
                        "<span>" + LandName + "</span></p></div>" +
                        '<div class="right fr clearfix">' +
                        '<span class="up fl" title="上移"></span>' +
                        '<span class="down fl" title="下移"></span>' +
                        "<span class=\"edit fl\" onclick=\"createOperate(this,'" + LandID + "','" +
                        DeviceExecution.DeviceID + "'," + DeviceExecution.DeviceSlotID + ",'" + data +
                        "',0,'" + time + "','','','')\" title=\"编辑\"></span>" +
                        '<span class="del fl" onclick="deleteoperateite(id,this)" title="删除"></span>' +
                        '</div>' +
                        '<div class="rank pa">1</div>' +
                        '</li>';
                    automation_execution.push({
                        value: value,
                        index: DeviceExecution.Index
                    });
                }) //pass
                $.each(item.AutomationExecution, function (index7, AutomationExecution) {
                    // console.log(AutomationExecution)
                    var text = "";
                    if (AutomationExecution.Action == "ACTIVATE")
                        text = "开启自动化";
                    else
                        text = "关闭自动化";
                    var value = '<li class="clearfix" category="automation_execution">' +
                        '<div class="left fl air_ico"></div>' +
                        '<div class="center fl">' +
                        '<p>' +
                        '<span>' + text + '</span>' +
                        '<span></span>' +
                        '</p><p><span>' + AutomationExecution.TargetAutomationName + '</span>' +
                        '<span></span>' +
                        '<span></span></p>' +
                        '</div>' +
                        '<div class="right fr clearfix">' +
                        '<span class="up fl" title="上移"></span>' +
                        '<span class="down fl" title="下移"></span>' +
                        "<span class=\"edit fl\" onclick=\"createOperate(this,'','','','',1,'','" +
                        AutomationExecution.TargetAutomationID + "','" + AutomationExecution.Action +
                        "','')\" title=\"编辑\"></span>" +
                        '<span class="del fl" onclick="deleteoperateite(id,this)" title="删除"></span>' +
                        '</div>' +
                        '<div class="rank pa">1</div>' +
                        '</li>';
                    automation_execution.push({
                        value: value,
                        index: AutomationExecution.Index
                    });
                })
                // DeviceTriggerCondition
                var DeviceTriggerCondition = item.DeviceTriggerCondition;
                if (DeviceTriggerCondition != null) {
                    if (DeviceTriggerCondition.BeginTime == "00:00:00" && DeviceTriggerCondition.EndTime !=
                        "23:59:59") {
                        var temp =
                            "<input class=\"fl\" type=\"radio\" name=\"time\" lay-filter=\"time\" value=\"1\" title=\"全天<span style='color:#c2c2c2;'>（00:00:00~23:59:59）</span>\" >" +
                            "<input disabled class=\"fl\" checked type=\"radio\" name=\"time\" lay-filter=\"time\" value=\"2\" title =\"自定义\" >";
                        $("#DeviceTriggerCondition").html(temp);
                        $(".custom_time").removeClass("hidden");
                        $("#time_box").val(DeviceTriggerCondition.BeginTime + " - " + DeviceTriggerCondition
                            .EndTime);
                        state = 2;
                    }
                    if (DeviceTriggerCondition.ConditionType == "AND") {
                        ConditionType = "AND";
                        var temp =
                            "<input lay-filter=\"ConditionType\" class=\"fl\" type=\"radio\" name=\"option\" value=\"AND\" title=\"满足所有条件时触发\" checked>" +
                            "<input lay-filter=\"ConditionType\" class=\"fl\" type =\"radio\" name=\"option\" value=\"OR\" title =\"满足任一条件时触发\">";
                        $("#ConditionType").html(temp);
                    }
                    form.render();
                }

                $.each(item.DeviceTrigger, function (index8, DeviceTrigger) {
                    var DeviceCategory = "";
                    var DeviceName = '';
                    var LandName = '';
                    var SlotName = '';
                    var LandID = "";
                    var SlotID = "";
                    $.each(autoMation.DeviceList, function (index, item) {
                        $.each(item.Devices, function (index2, item2) {
                            if (item2.DeviceID == DeviceTrigger.DeviceID) {
                                DeviceCategory = item2.Category;
                                DeviceName = item2.DeviceName;
                                LandName = item.LandName;
                                LandID = item.LandID;
                                $.each(item2.Slots, function (index3, item3) {
                                    if (item3.Slot == DeviceTrigger
                                        .DeviceSlotID) {
                                        SlotID = item3.Slot;
                                        SlotName = item3.SensorName;
                                    }
                                })
                            }
                        })
                    });
                    //temp = { "Data": data, "LandID": LandID, "DeviceID": DeviceID, "SlotID": SlotID, "Category": category };
                    var temp = {
                        "Data": DeviceTrigger.RelayStatus,
                        "LandID": LandID,
                        "DeviceID": DeviceTrigger.DeviceID,
                        "SlotID": SlotID,
                        "Category": DeviceCategory,
                        "EnableHigh": DeviceTrigger.EnableHigh,
                        "HighValue": DeviceTrigger.HighValue,
                        "EnableLow": DeviceTrigger.EnableLow,
                        "LowValue": DeviceTrigger.LowValue
                    };
                    autoMation.TriggerList.push(temp);
                    var equiptriggerobj;
                    var Condition = "";
                    if (DeviceCategory == 'CONTROLLER') {
                        if (DeviceTrigger.RelayStatus == 0)
                            Condition = "开";
                        if (DeviceTrigger.RelayStatus == 1)
                            Condition = "关";
                        if (DeviceTrigger.RelayStatus == 2)
                            Condition = "停";
                        equiptriggerobj = $("<li class='clearfix' category='CONTROLLER'>" +
                            "<div class='left fl temper_ico' style='background:url(\"../../images/automation/\")no-repeat center'></div>" +
                            "<div class='center fl'>" +
                            "<p>" + Condition + "</p>" +
                            "<p><span>" + DeviceName + "</span>" +
                            "<span>" + SlotName + "</span>" +
                            "<span>" + LandName + "</span></p></div>" +
                            "<div class='right fr clearfix'><span class='edit fl' onclick=\"autoMation.DeviceTrigger(this,'trigger')\" title='编辑'></span><span class='del fl' onclick='autoMation.deletetimefn(this)' title='删除'></span></div></li>"
                        );
                        // console.log("asdfasdfasdf");
                        // console.log(equiptriggerobj);
                    } else if (DeviceCategory == "SENSOR") {
                        Condition = "";
                        var EnableHigh = DeviceTrigger.EnableHigh == 0 ? false : true;
                        var HighValue = DeviceTrigger.HighValue;
                        var EnableLow = DeviceTrigger.EnableLow == 0 ? false : true;
                        var LowValue = DeviceTrigger.LowValue;
                        if (EnableHigh == true && HighValue != null && EnableLow == false && LowValue ==
                            null) {
                            Condition = Condition + "＞" + HighValue + "触发";
                        } else if (EnableHigh == false && HighValue == null && EnableLow == true &&
                            LowValue != null) {
                            Condition = Condition + "＜" + LowValue + "触发";
                        } else if (EnableHigh == true && HighValue != null && EnableLow == true &&
                            LowValue != null) {
                            if (HighValue < LowValue)
                                Condition = Condition + HighValue + "＜x＜" + LowValue + "触发";
                            if (HighValue > LowValue)
                                Condition = Condition + "＞" + HighValue + "或＜" + LowValue + "触发";
                            if (HighValue == LowValue)
                                Condition = Condition + "＝" + HighValue + "触发";
                        }
                        equiptriggerobj = $("<li class='clearfix' category='SENSOR'>" +
                            "<div class='left fl temper_ico' style='background:url(\"../../images/automation/\")no-repeat center'></div>" +
                            "<div class='center fl'>" +
                            "<p>" + Condition + "</p>" +
                            "<p><span>" + DeviceName + "</span>" +
                            "<span>" + SlotName + "</span>" +
                            "<span>" + LandName + "</span></p></div>" +
                            "<div class='right fr clearfix'><span class='edit fl' onclick=\"autoMation.DeviceTrigger(this,'trigger')\" title='编辑'></span><span class='del fl' onclick='autoMation.deletetimefn(this)' title='删除'></span></div></li>"
                        );
                    }

                    $(".list_wrap .factor_after").append(equiptriggerobj);
                    $(".option .opt_before").hide();
                    if (!$(".list_wrap .continue").is(':visible')) {
                        $(".list_wrap .continue").show();
                    }
                    if ($(".list_wrap ul.factor_after li.clearfix").length >= 2) {
                        $(".option .sub_tit form.conditions").show();
                    }
                    //选择设备触发条件 显示有效时间
                    $(".period").show();
                });

                if ($(".operate .operate_after li").length == 0) {
                    $(".operate .continue").show();
                }
                $(".operate_before li").addClass("hidden");
                $(".operate .continue").removeClass("hidden");

                automation_execution.sort(function (a, b) {
                    return a.index - b.index;
                });
                $.each(automation_execution, function (index10, Execution) {
                    $(".operate_after").append(Execution.value);
                });
                init(); //初始化 右边箭头
            });
        }
    };
    //时间戳转换
    function getdate(n) {
        n = n - (3600000 * 8);
        var newDtes = new Date();
        newDtes.setTime(parseInt(n));
        return newDtes;
    }

    Date.prototype.format = function (fmt) { //author: meizz
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate(), //日
            "h+": this.getHours(), //小时
            "m+": this.getMinutes(), //分
            "s+": this.getSeconds(), //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            "S": this.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) :
                (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    }

    //模糊搜索
    function searchMohu() {
        var dataInput = $('#searchM').val();
        var searchArr = [];
        $.each($('ul.operate_after').children(), function (index, item) {
            searchArr.push($(this).find('p:last span').html());
        })
        $.each(searchArr, function (index, item) {
            var index_ = index;
            if (item.indexOf(dataInput) != -1) {
                $('ul.operate_after').children().eq([index_]).addClass("autoSearch");
            } else {
                $('ul.operate_after').children().eq([index_]).removeClass("autoSearch");
            }
        });
    };
</script>